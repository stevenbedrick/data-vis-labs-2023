<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />


<meta name="author" content="Steven Bedrick" />


<title>Lab 08: Maps &amp; Cartography</title>

<script src="site_libs/header-attrs-2.20/header-attrs.js"></script>
<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/flatly.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>
<script src="site_libs/htmlwidgets-1.6.1/htmlwidgets.js"></script>
<link href="site_libs/leaflet-1.3.1/leaflet.css" rel="stylesheet" />
<script src="site_libs/leaflet-1.3.1/leaflet.js"></script>
<link href="site_libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet" />
<script src="site_libs/proj4-2.6.2/proj4.min.js"></script>
<script src="site_libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script>
<link href="site_libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet" />
<script src="site_libs/leaflet-binding-2.1.1/leaflet.js"></script>
<script src="site_libs/esri-leaflet-2.1.4/esri-leaflet-prod.js"></script>
<script src="site_libs/esri-leaflet-2.1.4/esri-leaflet-bindings.js"></script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>

<style type="text/css">code{white-space: pre;}</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>









<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
details > summary > p:only-child {
  display: inline;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark the anchor link active (and if it's in a dropdown, also mark that active)
  var dropdown = menuAnchor.closest('li.dropdown');
  if (window.bootstrap) { // Bootstrap 4+
    menuAnchor.addClass('active');
    dropdown.find('> .dropdown-toggle').addClass('active');
  } else { // Bootstrap 3
    menuAnchor.parent().addClass('active');
    dropdown.addClass('active');
  }

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before, .tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "\e259";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "\e258";
  font-family: 'Glyphicons Halflings';
  border: none;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-bs-toggle="collapse" data-target="#navbar" data-bs-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">BMI 5/625 Labs, Spring 2023</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="slides.html">Slides &amp; Reading</a>
</li>
<li>
  <a href="data-vis-resources.html">Resources</a>
</li>
<li>
  <a href="https://sakai.ohsu.edu/portal/site/BMI-525-1-AK-Sp23">Sakai</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="about.html">About</a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">



<h1 class="title toc-ignore">Lab 08: Maps &amp; Cartography</h1>
<h3 class="subtitle">BMI 5/625</h3>
<h4 class="author">Steven Bedrick</h4>

</div>


<div id="getting-started" class="section level1" number="1">
<h1><span class="header-section-number">1</span> Getting Started</h1>
<p>Today, we’ll be working with spatial data from the <a
href="https://www.portlandoregon.gov/28130">City of Portland’s GIS
team</a>. We’ll be working with a few different data sets, and will
produce several types of maps. To begin, let’s load All The
Libraries:</p>
<pre class="r"><code>library(tidyverse)
library(sf)
library(sp)
library(tmap)
library(osmdata)
library(ggmap)
library(readxl)
library(classInt)
library(cowplot)
library(maps)
library(ggspatial)</code></pre>
<div id="downloading-the-data" class="section level2" number="1.1">
<h2><span class="header-section-number">1.1</span> Downloading the
data</h2>
<p>The data sets we will be using today are:</p>
<ol style="list-style-type: decimal">
<li><a
href="https://gis-pdx.opendata.arcgis.com/datasets/neighborhoods-regions">Neighborhood
(Region) boundaries</a></li>
<li><a
href="https://gis-pdx.opendata.arcgis.com/datasets/willamette-columbia-river-ordinary-high-water">Willamette/Columbia
River Ordinary High Water</a></li>
<li><a
href="https://gis-pdx.opendata.arcgis.com/datasets/farmers-markets">Farmers
Markets</a></li>
<li><a
href="https://gis-pdx.opendata.arcgis.com/datasets/grocery-stores">Grocery
Stores</a></li>
<li><a
href="https://gis-pdx.opendata.arcgis.com/datasets/parks-tree-inventory">Parks
Tree Inventory</a></li>
</ol>
</div>
<div id="an-aside-vector-vs.-raster-data" class="section level2"
number="1.2">
<h2><span class="header-section-number">1.2</span> An aside: Vector
vs. Raster data</h2>
<p>In GIS-speak, these data sets are all <em>vector</em> data sets,
meaning that their contents are sets of x-y coordinates that define a
<em>feature</em> of some kind: a point (e.g., a specific grocery store),
a line or set of line segments (e.g., a road), or a polygon (e.g., the
outline of a neighborhood, or the shape of the bank of a river). Each
feature can have some number of <em>attributes</em>; what those
attributes are will depend on the specific data set.</p>
<p>In contrast to <em>vector</em> formats are <em>raster</em> formats
(sometimes called <em>bitmap</em> formats). Raster files consist of a
uniform grid of numbers (pixels), whose value contain whatever
information is being captured. One example of a raster image is a
digital photograph (perhaps taken from an airplane or satellite), in
which the pixel’s value corresponds to the intensity of light captured
at that exact point in the sensor’s field of view. but that is only one
form. Many kinds of remote sensing devices capture raster images, and in
fact there is no requirement that the values of each pixel correspond to
a sensor value at all- it can be a logical (categorical) value, as
well.</p>
<p>Crucially, raster images often contain multiple <em>channels</em>
(sometimes called <em>bands</em>), representing different sets of
spatially-aligned data. One example of this would be a visible-spectrum
true-color image, consisting of three bands (one for red, green, and
blue). Another example might be bands for sensors capturing at different
infrared wavelengths, or for different layers of data.</p>
<p>Like vector data, raster data files generally contain metadata
situating the pixels in a specific geographic coordinate reference
system. In other words, the raster file “knows” where its edges are in
space, and also knows how much distance each pixel is meant to cover.
One common raster file format is GeoTIFF, though there are certainly
others.</p>
<p><img src="https://i.stack.imgur.com/Y84dG.png" /></p>
</div>
<div id="spatial-data-in-a-non-spatial-format" class="section level2"
number="1.3">
<h2><span class="header-section-number">1.3</span> Spatial data in a
non-spatial format</h2>
<p>Here’s the data from the City of Portland park tree inventory, in CSV
format:</p>
<pre class="r"><code>trees_raw &lt;- read_csv(&quot;data/lab08/Parks_Tree_Inventory.csv&quot;)
glimpse(trees_raw)</code></pre>
<pre><code>## Rows: 25,534
## Columns: 41
## $ X                          &lt;dbl&gt; -13658194, -13658213, -13658254, -13658227,…
## $ Y                          &lt;dbl&gt; 5712487, 5712485, 5712491, 5712487, 5712488…
## $ OBJECTID                   &lt;dbl&gt; 426, 427, 428, 429, 430, 431, 432, 433, 434…
## $ Inventory_Date             &lt;chr&gt; &quot;2017/05/09 00:00:00+00&quot;, &quot;2017/05/09 00:00…
## $ Species                    &lt;chr&gt; &quot;PSME&quot;, &quot;PSME&quot;, &quot;CRLA&quot;, &quot;QURU&quot;, &quot;PSME&quot;, &quot;PS…
## $ DBH                        &lt;dbl&gt; 37.4, 32.5, 9.7, 10.3, 33.2, 32.1, 28.4, 27…
## $ Condition                  &lt;chr&gt; &quot;Fair&quot;, &quot;Fair&quot;, &quot;Fair&quot;, &quot;Poor&quot;, &quot;Fair&quot;, &quot;Fa…
## $ TreeHeight                 &lt;dbl&gt; 105, 94, 23, 28, 102, 95, 103, 105, 97, 112…
## $ CrownWidthNS               &lt;dbl&gt; 44, 49, 28, 38, 43, 35, 40, 45, 56, 35, 45,…
## $ CrownWidthEW               &lt;dbl&gt; 57, 45, 27, 31, 44, 39, 40, 29, 45, 33, 50,…
## $ CollectedBy                &lt;chr&gt; &quot;staff&quot;, &quot;staff&quot;, &quot;staff&quot;, &quot;staff&quot;, &quot;staff&quot;…
## $ Notes                      &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…
## $ CrownBaseHeight            &lt;dbl&gt; 4, 4, 3, 5, 4, 12, 6, 13, 5, 17, 6, 6, 4, 5…
## $ GlobalID                   &lt;chr&gt; &quot;{8413C6D7-038A-4685-AFCB-C3BCE4D90A24}&quot;, &quot;…
## $ StaffReview                &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…
## $ created_user               &lt;chr&gt; &quot;PARKS_ADMIN&quot;, &quot;PARKS_ADMIN&quot;, &quot;PARKS_ADMIN&quot;…
## $ created_date               &lt;chr&gt; &quot;2017/05/23 19:37:43+00&quot;, &quot;2017/05/23 19:37…
## $ last_edited_user           &lt;chr&gt; &quot;PKJOSHUA&quot;, &quot;PKJOSHUA&quot;, &quot;PKJOSHUA&quot;, &quot;PKJOSH…
## $ last_edited_date           &lt;chr&gt; &quot;2019/12/11 00:42:17+00&quot;, &quot;2019/12/11 00:42…
## $ UserID                     &lt;dbl&gt; 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, …
## $ Structural_Value           &lt;dbl&gt; 10101.06, 7900.55, 1110.81, 525.26, 8224.54…
## $ Carbon_Storage_lb          &lt;dbl&gt; 3223.3, 2460.8, 310.3, 400.1, 2533.4, 2333.…
## $ Carbon_Storage_value       &lt;dbl&gt; 209.07, 159.62, 20.13, 25.95, 164.33, 151.3…
## $ Carbon_Sequestration_lb    &lt;dbl&gt; 36.8, 31.3, 14.8, 6.0, 32.0, 30.8, 26.8, 25…
## $ Carbon_Sequestration_value &lt;dbl&gt; 2.39, 2.03, 0.96, 0.39, 2.08, 2.00, 1.74, 1…
## $ Stormwater_ft              &lt;dbl&gt; 150.3, 133.0, 35.4, 38.3, 115.5, 85.3, 99.7…
## $ Stormwater_value           &lt;dbl&gt; 10.05, 8.89, 2.37, 2.56, 7.72, 5.70, 6.66, …
## $ Pollution_Removal_value    &lt;dbl&gt; 18.25, 16.15, 4.31, 4.65, 14.03, 10.36, 12.…
## $ Pollution_Removal_oz       &lt;dbl&gt; 40.4, 35.8, 9.5, 10.3, 31.1, 22.9, 26.8, 22…
## $ Total_Annual_Benefits      &lt;dbl&gt; 30.69, 27.06, 7.64, 7.59, 23.82, 18.06, 20.…
## $ Family                     &lt;chr&gt; &quot;Pinaceae&quot;, &quot;Pinaceae&quot;, &quot;Rosaceae&quot;, &quot;Fagace…
## $ Genus                      &lt;chr&gt; &quot;Pseudotsuga&quot;, &quot;Pseudotsuga&quot;, &quot;Crataegus&quot;, …
## $ Common_name                &lt;chr&gt; &quot;Douglas-fir&quot;, &quot;Douglas-fir&quot;, &quot;Lavalle hawt…
## $ Genus_species              &lt;chr&gt; &quot;Pseudotsuga menziesii&quot;, &quot;Pseudotsuga menzi…
## $ Functional_type            &lt;chr&gt; &quot;CE&quot;, &quot;CE&quot;, &quot;BD&quot;, &quot;BD&quot;, &quot;CE&quot;, &quot;CE&quot;, &quot;CE&quot;, &quot;…
## $ Size                       &lt;chr&gt; &quot;L&quot;, &quot;L&quot;, &quot;S&quot;, &quot;L&quot;, &quot;L&quot;, &quot;L&quot;, &quot;L&quot;, &quot;L&quot;, &quot;L&quot;…
## $ Native                     &lt;chr&gt; &quot;Yes&quot;, &quot;Yes&quot;, &quot;No&quot;, &quot;No&quot;, &quot;Yes&quot;, &quot;Yes&quot;, &quot;Ye…
## $ Edible                     &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…
## $ Nuisance                   &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…
## $ Origin                     &lt;chr&gt; &quot;North America - from British Columbia sout…
## $ Species_factoid            &lt;chr&gt; &quot;Bracts on cones look like a mouse&#39;s feet a…</code></pre>
<p>We can use it like any data frame:</p>
<pre class="r"><code>trees_raw %&gt;% ggplot(mapping=aes(x=TreeHeight)) + geom_histogram(bins=50) + ggtitle(&quot;Histogram of park tree height&quot;)</code></pre>
<p><img src="08-maps_files/figure-html/tree%20height%20histogram-1.png" width="672" /></p>
<p>Let’s look closely at the <code>X</code> and <code>Y</code>
columns:</p>
<table class="huxtable" style="border-collapse: collapse; border: 0px; margin-bottom: 2em; margin-top: 2em; ; margin-left: auto; margin-right: auto;  " id="tab:unnamed-chunk-1">
<col><col><tr>
<th style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0.4pt 0.4pt;    padding: 6pt 6pt 6pt 6pt; font-weight: bold;">X</th><th style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0.4pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: bold;">Y</th></tr>
<tr>
<td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0.4pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">-1.37e+07</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0.4pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">5.71e+06</td></tr>
<tr>
<td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0.4pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">-1.37e+07</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0.4pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">5.71e+06</td></tr>
<tr>
<td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0.4pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">-1.37e+07</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0.4pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">5.71e+06</td></tr>
<tr>
<td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0.4pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">-1.37e+07</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0.4pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">5.71e+06</td></tr>
<tr>
<td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.4pt 0.4pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">-1.37e+07</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0.4pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">5.71e+06</td></tr>
</table>

<p>These clearly refer to some sort of spatial coordinates, and by
convention we can guess that they are in a projected (rather than
geographic) format- but without additional information it is difficult
to know how to interpret them. One major limitation of the CSV format is
that it does not make it easy to embed metadata like this in the file.
This is particularly important when working with geospatial data! As
such, we generally prefer to work with vector file formats such as
ESRI’s Shapefile format, which includes metadata.</p>
</div>
<div id="a-different-format-shapefiles" class="section level2"
number="1.4">
<h2><span class="header-section-number">1.4</span> A different format:
Shapefiles</h2>
<p>The Portland Maps Open Data site allows us to download data in ESRI’s
format; let’s take a look, using the <code>sf</code> package’s
<code>st_read</code> function:</p>
<pre class="r"><code>trees_shape &lt;- st_read(&quot;data/lab08/Parks_Tree_Inventory-shp&quot;)</code></pre>
<pre><code>## Reading layer `fd3ad191-4bf0-4577-b6ec-724baeb619792020413-1-a3eocm.isio&#39; from data source `/Users/bedricks/Dropbox/Work/Teaching/Spring 2023/Dataviz/labs/data-vis-labs-2023/data/lab08/Parks_Tree_Inventory-shp&#39; 
##   using driver `ESRI Shapefile&#39;
## Simple feature collection with 25534 features and 39 fields
## Geometry type: POINT
## Dimension:     XY
## Bounding box:  xmin: -13667450 ymin: 5692149 xmax: -13635010 ymax: 5724486
## Projected CRS: WGS 84 / Pseudo-Mercator</code></pre>
<p>Shapefiles, among other things, contain information about the
coordinate reference system (CRS) that they are using:</p>
<pre class="r"><code>st_crs(trees_shape)</code></pre>
<pre><code>## Coordinate Reference System:
##   User input: WGS 84 / Pseudo-Mercator 
##   wkt:
## PROJCRS[&quot;WGS 84 / Pseudo-Mercator&quot;,
##     BASEGEOGCRS[&quot;WGS 84&quot;,
##         ENSEMBLE[&quot;World Geodetic System 1984 ensemble&quot;,
##             MEMBER[&quot;World Geodetic System 1984 (Transit)&quot;],
##             MEMBER[&quot;World Geodetic System 1984 (G730)&quot;],
##             MEMBER[&quot;World Geodetic System 1984 (G873)&quot;],
##             MEMBER[&quot;World Geodetic System 1984 (G1150)&quot;],
##             MEMBER[&quot;World Geodetic System 1984 (G1674)&quot;],
##             MEMBER[&quot;World Geodetic System 1984 (G1762)&quot;],
##             MEMBER[&quot;World Geodetic System 1984 (G2139)&quot;],
##             ELLIPSOID[&quot;WGS 84&quot;,6378137,298.257223563,
##                 LENGTHUNIT[&quot;metre&quot;,1]],
##             ENSEMBLEACCURACY[2.0]],
##         PRIMEM[&quot;Greenwich&quot;,0,
##             ANGLEUNIT[&quot;degree&quot;,0.0174532925199433]],
##         ID[&quot;EPSG&quot;,4326]],
##     CONVERSION[&quot;Popular Visualisation Pseudo-Mercator&quot;,
##         METHOD[&quot;Popular Visualisation Pseudo Mercator&quot;,
##             ID[&quot;EPSG&quot;,1024]],
##         PARAMETER[&quot;Latitude of natural origin&quot;,0,
##             ANGLEUNIT[&quot;degree&quot;,0.0174532925199433],
##             ID[&quot;EPSG&quot;,8801]],
##         PARAMETER[&quot;Longitude of natural origin&quot;,0,
##             ANGLEUNIT[&quot;degree&quot;,0.0174532925199433],
##             ID[&quot;EPSG&quot;,8802]],
##         PARAMETER[&quot;False easting&quot;,0,
##             LENGTHUNIT[&quot;metre&quot;,1],
##             ID[&quot;EPSG&quot;,8806]],
##         PARAMETER[&quot;False northing&quot;,0,
##             LENGTHUNIT[&quot;metre&quot;,1],
##             ID[&quot;EPSG&quot;,8807]]],
##     CS[Cartesian,2],
##         AXIS[&quot;easting (X)&quot;,east,
##             ORDER[1],
##             LENGTHUNIT[&quot;metre&quot;,1]],
##         AXIS[&quot;northing (Y)&quot;,north,
##             ORDER[2],
##             LENGTHUNIT[&quot;metre&quot;,1]],
##     USAGE[
##         SCOPE[&quot;Web mapping and visualisation.&quot;],
##         AREA[&quot;World between 85.06°S and 85.06°N.&quot;],
##         BBOX[-85.06,-180,85.06,180]],
##     ID[&quot;EPSG&quot;,3857]]</code></pre>
<p>There’s a lot of information here, but looking through it we can see
that the coordinates in this file are against the WGS 84 datum, and that
the units are meters. Beyond that, the exact details are, for the
moment, not that important. Just know that, taken all together, this is
sufficient information for us to plot these points on a map and combine
them with any other geospatial data we might encounter.</p>
<p>In many ways, the object we get back is <em>like</em> a data frame,
in that there are columns, which have types, etc. In fact, most
<code>dplyr</code> functions work just fine on these. One of the columns
is called <code>geometry</code>, and is what store the actual
coordinates of whatever objects are stored in the rows. In this case,
each row is a tree, and the relevant <code>geometry</code> entry is a
point.</p>
<pre class="r"><code>trees_shape$geometry</code></pre>
<pre><code>## Geometry set for 25534 features 
## Geometry type: POINT
## Dimension:     XY
## Bounding box:  xmin: -13667450 ymin: 5692149 xmax: -13635010 ymax: 5724486
## Projected CRS: WGS 84 / Pseudo-Mercator
## First 5 geometries:</code></pre>
<pre><code>## POINT (-13658194 5712487)</code></pre>
<pre><code>## POINT (-13658213 5712485)</code></pre>
<pre><code>## POINT (-13658254 5712491)</code></pre>
<pre><code>## POINT (-13658227 5712487)</code></pre>
<pre><code>## POINT (-13658234 5712488)</code></pre>
<p>For more information about this kind of file, see <a
href="https://r-spatial.github.io/sf/articles/sf1.html">the
documentation</a>. A helpful deep-dive into the format of this object <a
href="https://www.jessesadler.com/post/simple-feature-objects/">can be
found here</a>, if you’re <em>really</em> interested in what’s going on
in that <code>$geometry</code> property. :-)</p>
</div>
</div>
<div id="our-first-map" class="section level1" number="2">
<h1><span class="header-section-number">2</span> Our first map</h1>
<p>Our first map will be a simple one, showing the various neighborhood
boundaries in Portland.</p>
<pre class="r"><code>pdx_boundaries &lt;- st_read(&quot;data/lab08//Neighborhoods__Regions_-shp&quot;)</code></pre>
<p>While we’re at it, we will also load a second shapefile, that
includes the geography of the Willamette and Columbia rivers:</p>
<pre class="r"><code>river_boundaries &lt;- st_read(&quot;data/lab08//Willamette_Columbia_River_Ordinary_High_Water-shp/&quot;)</code></pre>
<p>Once we have loaded the shapefiles, we have many options. The
built-in base-R <code>plot</code> function can handle these, as can
<code>ggplot</code> via <code>sf</code>’s <code>geom_sf</code>:</p>
<pre class="r"><code>pdx_boundaries %&gt;% ggplot() + geom_sf()</code></pre>
<p><img src="08-maps_files/figure-html/unnamed-chunk-3-1.png" width="672" /></p>
<p>Let’s look more closely at our boundaries data set:</p>
<pre class="r"><code>glimpse(pdx_boundaries)</code></pre>
<pre><code>## Rows: 98
## Columns: 11
## $ OBJECTID   &lt;int&gt; 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, …
## $ NAME       &lt;chr&gt; &quot;CATHEDRAL PARK&quot;, &quot;UNIVERSITY PARK&quot;, &quot;PIEDMONT&quot;, &quot;WOODLAWN&quot;…
## $ COMMPLAN   &lt;chr&gt; NA, NA, &quot;ALBINA&quot;, &quot;ALBINA&quot;, NA, &quot;ALBINA&quot;, &quot;ALBINA&quot;, &quot;ALBINA…
## $ SHARED     &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…
## $ COALIT     &lt;chr&gt; &quot;NPNS&quot;, &quot;NPNS&quot;, &quot;NPNS&quot;, &quot;NECN&quot;, &quot;CNN&quot;, &quot;NPNS&quot;, &quot;NPNS&quot;, &quot;NEC…
## $ HORZ_VERT  &lt;chr&gt; &quot;HORZ&quot;, &quot;HORZ&quot;, &quot;VERT&quot;, &quot;HORZ&quot;, &quot;HORZ&quot;, &quot;HORZ&quot;, &quot;HORZ&quot;, &quot;HO…
## $ MAPLABEL   &lt;chr&gt; &quot;Cathedral Park&quot;, &quot;University Park&quot;, &quot;Piedmont&quot;, &quot;Woodlawn&quot;…
## $ ID         &lt;int&gt; 31, 88, 70, 93, 23, 2, 66, 19, 67, 84, 44, 48, 89, 63, 74, …
## $ Shape_Leng &lt;dbl&gt; 11434.255, 11950.860, 10849.327, 8078.361, 18179.392, 9466.…
## $ Shape_Area &lt;dbl&gt; 5424297.8, 6981456.8, 6079530.0, 3870553.6, 16580624.7, 458…
## $ geometry   &lt;MULTIPOLYGON [m]&gt; MULTIPOLYGON (((-13664216 5..., MULTIPOLYGON (…</code></pre>
<p>We see that in addition to the geometry of the boundaries themselves,
we also have other columns containing information about each
neighborhood. Notably, one of these is called <code>MAPLABEL</code>-
let’s take that as a suggestion and try labeling our regions:</p>
<pre class="r"><code>pdx_boundaries %&gt;% ggplot() + geom_sf() + geom_sf_label(aes(label=MAPLABEL))</code></pre>
<p>Note what is happening, here: <code>geom_sf_label()</code> provides a
new <code>ggplot</code> aesthetic to map (<code>label</code>), and we
are mapping it to a data value just like we would in any other geom.</p>
<p>Let’s look at the resulting map:</p>
<p><img src="08-maps_files/figure-html/unnamed-chunk-5-1.png" width="672" /></p>
<p>This map on its own is not especially useful, due to all of the
overlap, but perhaps if we zoom in a bit? We can modify our map’s
viewport by using <code>coord_sf</code></p>
<pre class="r"><code>pdx_boundaries %&gt;% ggplot() + geom_sf() + 
  coord_sf(
    xlim=c(-13670000,-13630000), 
    ylim=c(5690000, 5710000)
  )</code></pre>
<p><img src="08-maps_files/figure-html/changing%20our%20viewport-1.png" width="672" /></p>
<p>Note that the units here are in the same CRS as the original
shapefile, but that the map itself is being displayed with
latitude/longitude tick marks. We’ll see shortly how we might convert
coordinates between the two CRSs, and also discuss what these numbers
mean. In the meantime, let’s zoom in some more (by specifying a narrower
range):</p>
<pre class="r"><code>pdx_boundaries %&gt;% ggplot() + geom_sf() + 
  coord_sf(
    xlim=c(-13665000,-13655000), 
    ylim=c(5693277, 5698277)) +
    geom_sf_label(aes(label=MAPLABEL))</code></pre>
<p><img src="08-maps_files/figure-html/really%20zooming%20in-1.png" width="672" /></p>
<div class="panel panel-success">
<div class="panel-heading">
Challenge #1:
</div>
<div class="panel-body">
<pre><code>Make a version of this map centered on _your_ neighborhood, zoomed such that each of the bordering neighborhoods is visible (if &quot;each&quot; is too many to be useful, go with &quot;most&quot; or &quot;some&quot;).</code></pre>
</div>
</div>
<div id="adding-a-layer" class="section level2" number="2.1">
<h2><span class="header-section-number">2.1</span> Adding a layer</h2>
<p>There’s something missing from our map: the two lovely rivers that
define our city’s geography. We have loaded a shapefile that describes
the river; let’s have a look:</p>
<pre class="r"><code>river_boundaries %&gt;% glimpse()</code></pre>
<pre><code>## Rows: 1
## Columns: 6
## $ OBJECTID   &lt;int&gt; 1
## $ Id         &lt;int&gt; 6720
## $ gridcode   &lt;int&gt; 1
## $ Shape_Leng &lt;dbl&gt; 419214
## $ Shape_Area &lt;dbl&gt; 114297817
## $ geometry   &lt;MULTIPOLYGON [m]&gt; MULTIPOLYGON (((-13669922 5...</code></pre>
<p>Unlike the <code>pdx_boundaries</code> data set, there’s not a lot of
additional information in this one beyond the raw geometry of the river
(the Portland Maps site does have additional data sets available that
include bathymetric and other data). What does this geometry look
like?</p>
<pre class="r"><code>river_boundaries %&gt;% ggplot() + geom_sf()</code></pre>
<p><img src="08-maps_files/figure-html/just%20river-1.png" width="672" /></p>
<p>Hey, there’s our rivers! But the shape is grey; how might we turn it
blue? <code>geom_sf</code> behaves like all other <code>ggplot</code>
directives, and allows us to set aesthetic parameters directly or map
them to data values:</p>
<pre class="r"><code>river_boundaries %&gt;% ggplot() + geom_sf(fill=&quot;blue&quot;)</code></pre>
<p><img src="08-maps_files/figure-html/blue%20river-1.png" width="672" /></p>
<p>We may also note that this map took a few seconds to render. That is
because the geometry of the river is surprisingly complex, especially
along the banks of the Columbia. We can help it out a bit by turning off
the outline; rendering that is particularly challenging for the noisy
parts of the river bank:</p>
<pre class="r"><code>river_boundaries %&gt;% ggplot() + geom_sf(fill=&quot;blue&quot;, size=0.0)</code></pre>
<p><img src="08-maps_files/figure-html/river%20no%20outline-1.png" width="672" /></p>
<p>Another option is to “simplify” the outline of the river, by
smoothing out some of the very detailed parts of the polygon. Depending
on the kind of map we are making, and the scale at which we are working,
this may or may not be appropriate, but for our purposes today it’s just
fine:</p>
<pre class="r"><code>river_boundaries %&gt;% st_simplify(dTolerance = 10) %&gt;% 
  ggplot() + geom_sf(fill=&quot;blue&quot;, size=0.0)</code></pre>
<p><img src="08-maps_files/figure-html/river_simplified-1.png" width="672" /></p>
<p>For the rest of this lab, we will work with a simplified version of
the river outline:</p>
<pre class="r"><code>river_boundaries &lt;- river_boundaries %&gt;% st_simplify(dTolerance = 10) </code></pre>
<p>Now, how do we combine our river layer with our neighborhood boundary
layer? Regular <code>ggplot</code> geoms can be combined arbitrarily,
and so can <code>geom_sf</code> layers:</p>
<pre class="r"><code>pdx_boundaries %&gt;% ggplot() + geom_sf() + geom_sf(data=river_boundaries, fill=&quot;blue&quot;, size=0.0)</code></pre>
<p><img src="08-maps_files/figure-html/river%20and%20city-1.png" width="672" /></p>
<p>Putting it all together, we can see that <code>coord_sf</code>
applies to both data layers, and also that regular ggplot themeing
applies here as well:</p>
<pre class="r"><code>pdx_boundaries %&gt;% ggplot() + 
  geom_sf() + 
  geom_sf(data=river_boundaries, fill=&quot;blue&quot;, size=0.0) + 
  coord_sf(xlim=c(-13670000,-13630000), ylim=c(5690000, 5710000)) +
  theme_minimal()</code></pre>
<p><img src="08-maps_files/figure-html/zoomed%20city%20and%20river-1.png" width="672" /></p>
<div class="panel panel-success">
<div class="panel-heading">
Challenge #2:
</div>
<div class="panel-body">
<pre><code>That blue is pretty deep and intense; change it to something a bit more river-like. 

While you&#39;re at it, the grey background for the neighborhoods is also a bit &quot;blah.&quot; Try changing it to something else.</code></pre>
</div>
</div>
</div>
</div>
<div
id="converting-between-geographic-coordinates-and-projection-coordinates"
class="section level1" number="3">
<h1><span class="header-section-number">3</span> Converting between
geographic coordinates and projection coordinates</h1>
<p>The coordinates that the Portland Maps data are using are not in
lat/long, but rather in meters (as can be seen by closely examining the
output of <code>st_crs</code>). If you’d rather work with latitude and
longitude, or if you need to get them to line up with data from a
different source, you can convert back and forth between CRSs using
<code>sf_project()</code>. The key is knowing how to tell
<code>sf_project()</code> which CRS to use.</p>
<p>One option would be to give it all of the extensive and detailed
information about the projection and datum that is found using
<code>st_crs()</code>; fortunately, there exists a standardized registry
of spatial reference systems, the <a
href="https://en.wikipedia.org/wiki/EPSG_Geodetic_Parameter_Dataset">EPSG
Geodetic Parameter Dataset</a>, and we can look up CRS configurations
using their EPSG reference number.</p>
<p>Let’s walk through how to use <code>sf_project()</code>. First, we’ll
need a point in WGS84-space:</p>
<pre class="r"><code>p1 &lt;- data.frame(lon=c(-122.65), lat=c(45.5))</code></pre>
<p>Next, we figure out the EPSG numbers for our source and target CRS.
Our source CRS is WGS84, whose CRS number is 4326; let’s say that we
wanted to project it into the space that the Portland Maps data is
using, so that we could overlay the points or do some sort of distance
calculation. The Portland Maps dataset uses EPSG 3857, also known as
“Web Mercator”. This is basically WGS84, but it has been “quasi-Mercator
projected,” and converted to use meters as units and easting/northing as
its direction system (instead of lat/long).</p>
<p>Web Mercator is used by a variety of mapping software packages
(including Google Maps, etc.), hence why it’s what Portland Maps gives.
The motivation behind Web Mercator is that it depends on a spherical
projection geometry (rather than the ellipsoidal projection used by
vanilla Mercator). This makes it vastly simpler to work with from a
computational perspective… at the cost of substantially decreased
accuracy at northern latitudes, even by Mercator standards. For this
reason, the metadata includes a <code>USAGE</code> note saying that it
is only specified for use at latitudes between 85º N and 85º S. In
practice, it is best to not push things even that far; you’ll see
notable distortion by the time you get to Norway and Alaska.</p>
<p>Anyway now that we know which CRS systems are in play, we can use
<code>sf_project()</code>:</p>
<pre class="r"><code>sf_project(
  sf::st_crs(4326), # from: default datum used by geom_sf
  sf::st_crs(3857), # to: datum used by Portland Maps data
  p1
)</code></pre>
<pre><code>##           [,1]    [,2]
## [1,] -13653336 5700583</code></pre>
<p>The process works in reverse:</p>
<pre class="r"><code>p2 &lt;- data.frame(lon=c(-13653336), lat=c(5700583))
sf_project(
  sf::st_crs(3857), # from: datum used by Portland Maps data
  sf::st_crs(4326), # to: default datum used by geom_sf
  p2
)</code></pre>
<pre><code>##         [,1] [,2]
## [1,] -122.65 45.5</code></pre>
<p>Another common way to define a CRS is with a “<code>PROJ.4</code>”
string. Instead of referring to a standard, predefined projection as
with an EPSG code, the proj.4 string includes all of the necessary
information to describe an arbitrary projection. Consider this example,
from the <code>geom_sf</code> documentation:</p>
<pre class="r"><code>world1 &lt;- sf::st_as_sf(map(&#39;world&#39;, plot = FALSE, fill = TRUE))
ggplot() + geom_sf(data = world1)</code></pre>
<p><img src="08-maps_files/figure-html/unnamed-chunk-10-1.png" width="672" /></p>
<pre class="r"><code># now, project to a Lambert Equal-Area Projection, centered at Antarctica:
world2 &lt;- sf::st_transform(
  world1,
  &quot;+proj=laea +y_0=0 +lon_0=155 +lat_0=-90 +ellps=WGS84 +no_defs&quot;
)
ggplot() + geom_sf(data = world2)</code></pre>
<p><img src="08-maps_files/figure-html/unnamed-chunk-11-1.png" width="672" /></p>
<p>A deep-dive into proj.4 strings is beyond the scope of this lab, but
as a challenge: look closely at that string, and see if you can think of
a way to modify it to project centered on Portland (lon: -122.65, lat:
45.5), to make the following plot:</p>
<p><img src="08-maps_files/figure-html/unnamed-chunk-12-1.png" width="672" /></p>
<div class="panel panel-success">
<div class="panel-heading">
Challenge #3:
</div>
<div class="panel-body">
<pre><code>Pick a _different_ projection, and show how it looks with at least _two_ different center points. [Here is a guide](https://mgimond.github.io/Spatial/coordinate-systems-in-r.html#understanding-the-proj4-coordinate-syntax) to a little bit more information about the syntax for the proj4 specification.</code></pre>
</div>
</div>
</div>
<div id="plotting-points" class="section level1" number="4">
<h1><span class="header-section-number">4</span> Plotting Points</h1>
<p>Now that we can draw a base map, it’s time to try plotting some data.
Let’s load up the tree census, farmer’s marker, and grocery store data
sets.</p>
<pre class="r"><code>trees_shape &lt;- st_read(&quot;data/lab08/Parks_Tree_Inventory-shp&quot;)
farmers_market &lt;- st_read(&quot;data/lab08/Farmers_Markets-shp/&quot;)
grocery_stores &lt;- st_read(&quot;data/lab08/Grocery_Stores-shp/&quot;)</code></pre>
<p>Beginning with the farmer’s market data set:</p>
<pre class="r"><code>glimpse(farmers_market)</code></pre>
<pre><code>## Rows: 20
## Columns: 12
## $ OBJECTID   &lt;int&gt; 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, …
## $ xcoord     &lt;dbl&gt; 7639494, 7659590, 7667868, 7650248, 7652231, 7641969, 76715…
## $ ycoord     &lt;dbl&gt; 668024.5, 688714.1, 682226.2, 666265.0, 675950.3, 680443.0,…
## $ Market     &lt;chr&gt; &quot;Hillsdale Farmers Market&quot;, &quot;Hollywood Farmers Market&quot;, &quot;Mo…
## $ Location   &lt;chr&gt; &quot;SW Capitol Highway and SW Sunset Boulevard&quot;, &quot;NE 44th Aven…
## $ Day        &lt;chr&gt; &quot;Sunday&quot;, &quot;Saturday&quot;, &quot;Sunday&quot;, &quot;Wednesday&quot;, &quot;Wednesday&quot;, &quot;…
## $ Open_Dates &lt;chr&gt; &quot;March 3, 17 &amp; 31, April  14; weekly April 28 - November 24…
## $ Open_Times &lt;chr&gt; &quot;9 a.m. - 1 p.m&quot;, &quot;8 a.m. - 1 p.m. (April - Sept) \n9 a.m. …
## $ Accepts    &lt;chr&gt; &quot;cash, credit, debit, SNAP (up to $10 match) and FDNP&quot;, &quot;de…
## $ Website    &lt;chr&gt; &quot;http://www.hillsdalefarmersmarket.com&quot;, &quot;http://hollywoodf…
## $ status     &lt;chr&gt; &quot;Active&quot;, &quot;Active&quot;, &quot;Active&quot;, &quot;Active&quot;, &quot;Active&quot;, &quot;Active&quot;,…
## $ geometry   &lt;POINT [m]&gt; POINT (-13658191 5697100), POINT (-13649708 5706344),…</code></pre>
<p>Just like we overlaid the river layer, we can do the same with the
market. The coordinate systems are all aligned, so this will Just
Work:</p>
<pre class="r"><code>pdx_boundaries %&gt;% ggplot() +geom_sf() + 
  geom_sf(data=river_boundaries, fill=&quot;blue&quot;, size=0.0) + 
  geom_sf(data=farmers_market) +
  ggtitle(&quot;Portland Farmer&#39;s Markets&quot;) +
  theme_minimal()</code></pre>
<p><img src="08-maps_files/figure-html/adding%20markets-1.png" width="672" /></p>
<p>We use aesthetic mappings, like any other ggplot geom:</p>
<pre class="r"><code>pdx_boundaries %&gt;% ggplot() +geom_sf() + 
  geom_sf(data=river_boundaries, fill=&quot;blue&quot;, size=0.0) + 
  geom_sf(data=farmers_market, mapping=aes(color=Day)) +
  ggtitle(&quot;Portland Farmer&#39;s Markets, by Day&quot;) +
  theme_minimal()</code></pre>
<p><img src="08-maps_files/figure-html/coloring%20by%20day-1.png" width="672" /></p>
<div class="panel panel-success">
<div class="panel-heading">
Challenge #4:
</div>
<div class="panel-body">
<p>Create a map showing the location of grocery stores and farmer’s
markets, with a different point shape used to indicate which is
which.</p>
</div>
</div>
<div id="adding-more-data" class="section level2" number="4.1">
<h2><span class="header-section-number">4.1</span> Adding more data</h2>
<p>Let’s dig in a bit to the grocery store data set:</p>
<pre class="r"><code>grocery_stores %&gt;% glimpse</code></pre>
<pre><code>## Rows: 123
## Columns: 10
## $ OBJECTID  &lt;int&gt; 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 1…
## $ ADDRESS   &lt;chr&gt; &quot;330 1ST ST, 97034&quot;, &quot;1222 NE 102ND AVE, 97220&quot;, &quot;7500 SW DA…
## $ NAME      &lt;chr&gt; &quot;Wizer&#39;s Grocery&quot;, &quot;Winco Foods&quot;, &quot;Winco Foods&quot;, &quot;Winco Food…
## $ STATE_ID  &lt;chr&gt; &quot;21E03DD08300&quot;, &quot;1N2E34BB  4300&quot;, &quot;1S136DC04500&quot;, &quot;1N2E26CC …
## $ BLDG_SQFT &lt;int&gt; 43128, 61599, 87996, 103040, 10000, 5257, 7596, 10711, 51825…
## $ STATUS    &lt;chr&gt; &quot;Existing&quot;, &quot;Existing&quot;, &quot;Existing&quot;, &quot;Existing&quot;, &quot;Existing&quot;, …
## $ TYPE      &lt;chr&gt; &quot;Independent or Ethnic Grocery&quot;, &quot;Large Chain Grocery&quot;, &quot;Lar…
## $ X         &lt;dbl&gt; 7646238, 7674902, 7623671, 7680439, 7647761, 7652200, 763836…
## $ Y         &lt;dbl&gt; 646225.0, 686504.9, 652777.9, 688331.7, 683210.1, 675961.4, …
## $ geometry  &lt;POINT [m]&gt; POINT (-13655011 5687695), POINT (-13642965 5705539), …</code></pre>
<p>As before, we can map standard ggplot aesthetics:</p>
<pre class="r"><code>pdx_boundaries %&gt;% ggplot() +geom_sf() + 
  geom_sf(data=river_boundaries, fill=&quot;blue&quot;, size=0.0) + 
  geom_sf(data=grocery_stores, mapping=aes(color=TYPE)) +
  ggtitle(&quot;Portland Grocery Stores, by Type&quot;) +
  theme_minimal()</code></pre>
<p><img src="08-maps_files/figure-html/grocery%20by%20type-1.png" width="672" /></p>
<p>Note that for exploring this part of the data, we may wish to bring
in additional layers- perhaps the routes of I-5 and I-205. Other major
arterial roads may also be important (Foster, Powell, and 82nd on the
East side come to mind, as does Barbur and Capitol Highway on the West
side).</p>
<p>With this many data points, it may begin to make sense to look not at
discrete points but rather at a density or contour plot. Making this is
a tiny bit more complicated, since the <code>X</code> and <code>Y</code>
columns in this particular data set do not seem to be in the same
coordinate system, and it is not entirely obvious from the Portland Maps
site what system those columns are in. 😣 Fortunately, the points in the
<code>$geometry</code> column are just fine, and we can extract those
using <code>st_coordinates</code> for use by
<code>stat_density_2d</code>:</p>
<pre class="r"><code>pdx_boundaries %&gt;% ggplot() +
  geom_sf() + 
  geom_sf(data=river_boundaries, fill=&quot;blue&quot;, size=0.0) + 
  geom_sf(data=grocery_stores, color=scales::alpha(&quot;seagreen&quot;, 0.45)) +
  stat_density_2d(
    data=data.frame(st_coordinates(grocery_stores$geometry)), 
    mapping=aes(X,Y), 
    color=&quot;red&quot;, 
    alpha=0.5)  +
  ggtitle(&quot;Portland Grocery Stores&quot;) +
  theme_minimal()</code></pre>
<p><img src="08-maps_files/figure-html/grocery%20contour-1.png" width="672" /></p>
<p>We see a relative paucity of grocery stores in the far eastern part
of the city as compared to the west and inner parts of the east
side.</p>
</div>
<div id="now-lets-look-at-the-trees" class="section level2"
number="4.2">
<h2><span class="header-section-number">4.2</span> Now let’s look at the
trees</h2>
<p>The tree inventory data set is a different kettle of fish altogether.
First, it is much larger:</p>
<pre class="r"><code>nrow(trees_shape)</code></pre>
<pre><code>## [1] 25534</code></pre>
<p>This means that plotting these points is going to be a lot more work
for R. Furthermore, the distribution of the points is rather clumpy:</p>
<pre class="r"><code>pdx_boundaries %&gt;% ggplot() + geom_sf() + 
  geom_sf(data=river_boundaries, fill=&quot;blue&quot;, size=0.0) + 
  geom_sf(data=trees_shape)</code></pre>
<p><img src="08-maps_files/figure-html/initial%20trees-1.png" width="672" /></p>
<p>In essence, each of those black blobs is hundreds of points overlaid
on top of one another. If we do a contour map, we can see this more
clearly:</p>
<pre class="r"><code>pdx_boundaries %&gt;% ggplot() + geom_sf() + stat_density_2d(data=trees_raw, aes(X, Y))</code></pre>
<p><img src="08-maps_files/figure-html/tree%20contour-1.png" width="672" /></p>
<p>What is going on, here? Well, let’s zoom in a bit on Southwest
portland:</p>
<pre class="r"><code>pdx_boundaries %&gt;% ggplot() + geom_sf() + geom_sf(data=river_boundaries, fill=&quot;blue&quot;, size=0.0) + geom_sf(data=trees_shape) + coord_sf(xlim=c(-13662000,-13658000), ylim=c(5693059, 5697583))</code></pre>
<p><img src="08-maps_files/figure-html/unnamed-chunk-16-1.png" width="672" /></p>
<p>That large clump up in the upper left-hand corner is Gabriel Park,
and we can see now that the individual points in this data set are
crammed in close together because they represent trees that are
literally next to one another in a park. Our contour map above is really
just showing us what parts of town have a lot of tree-filled parks!</p>
<p>Let’s explore the tree data a bit more by zooming in to Gabriel Park.
We’ll first subset our data to only include trees in that park, so let’s
eyeball a bounding box:</p>
<p><img src="08-maps_files/figure-html/unnamed-chunk-17-1.png" width="672" /></p>
<p>We can guesstimate some lon/lat coordinates, and project them into
map units:</p>
<pre class="r"><code>p3 &lt;- data.frame(lon=c(-122.725, -122.7125), lat=c(45.4675, 45.478))
sf_project(
  sf::st_crs(4326), # from: default datum used by geom_sf
  sf::st_crs(3857), # to: datum used by Portland Maps data
  p3
)</code></pre>
<pre><code>##           [,1]    [,2]
## [1,] -13661685 5695423
## [2,] -13660293 5697089</code></pre>
<p>And then use <code>st_crop</code> to filter our data set:</p>
<pre class="r"><code>trees_in_park &lt;- st_crop(trees_shape, xmin=-13661685, ymin=5695423, xmax=-13660293, ymax=5697089)
paste0(&quot;Total number of trees in original dataset: &quot;, length(trees_shape$geometry))</code></pre>
<pre><code>## [1] &quot;Total number of trees in original dataset: 25534&quot;</code></pre>
<pre class="r"><code>paste0(&quot;Number of trees in our bounding box: &quot;, length(trees_in_park$geometry))</code></pre>
<pre><code>## [1] &quot;Number of trees in our bounding box: 618&quot;</code></pre>
<p>If we zoom in to just this box, what does our map look like?</p>
<pre class="r"><code>pdx_boundaries %&gt;% ggplot() + geom_sf() + 
  geom_sf(data=river_boundaries, fill=&quot;blue&quot;, size=0.0) + 
  geom_sf(data=trees_in_park) + 
  coord_sf(xlim=c(-13661685,-13660293), ylim=c(5695423, 5697089)) </code></pre>
<p><img src="08-maps_files/figure-html/unnamed-chunk-20-1.png" width="672" /></p>
<div class="panel panel-success">
<div class="panel-heading">
Challenge #5:
</div>
<div class="panel-body">
<p>Follow this process (cropping the data set to a bounding box, etc.)
for a park in your neighborhood, and create a comparable map.</p>
</div>
</div>
<p>Note that, besides the trees themselves, this map is kind of boring.
We can start to see the layout of trees in the park, but it’s hard to
know how to contextualize it. At this zoom level, our neighborhood
boundary data set is no longer especially useful. We might instead want
other features: roads, etc. Or, we might want to base our map on other
data entirely, like perhaps an aerial photo. One option would be for us
to find that data (roads, for instance, are available from Portland
Maps) and manually add it, the way we did with the rivers. There are
easier options, however. Let’s look at how we might use a richer,
pre-built map using OpenStreetMap data and <code>ggmap</code>.</p>
</div>
<div id="ggmap" class="section level2" number="4.3">
<h2><span class="header-section-number">4.3</span>
<code>ggmap</code></h2>
<p>`<code>ggmap</code> is a package that tries to make it convenient to
quickly access raster map tiles through either Google Maps or
OpenStreetMap to use as a “basemap”. Using Google Maps requires setting
up an account with a credit card (though for reasonable numbers of
requests, it is free); OSM via Stamen is free, so we’ll use that
today.</p>
<p><code>ggmap</code> We’ll need the bounding box of the trees we want
to plot; we can get that using <code>st_bbox()</code>:</p>
<pre class="r"><code>st_bbox(trees_in_park)</code></pre>
<pre><code>##      xmin      ymin      xmax      ymax 
## -13661462   5695679 -13660633   5696789</code></pre>
<p>Next, we generate a basemap using <code>get_stamenmap()</code> (there
are related functions for different tile sets).</p>
<pre class="r"><code>park_base_map &lt;- get_stamenmap(
  c(left=-122.725, bottom=45.4675, right=-122.7125, top=45.478),
  zoom=16,
  maptype=&quot;terrain&quot;) # try experimenting with &quot;toner&quot;, etc.  </code></pre>
<pre><code>## ℹ Map tiles by Stamen Design, under CC BY 3.0. Data by OpenStreetMap, under ODbL.</code></pre>
<pre class="r"><code>ggmap(park_base_map)</code></pre>
<p><img src="08-maps_files/figure-html/unnamed-chunk-22-1.png" width="672" /></p>
<p>Now, we are ready to try plotting the trees over our base map. Our
trees and basemap are in different projections, and <code>ggmap</code>
can’t quite handle that situation “on its own”. We must manually
re-project our trees’ locations:</p>
<pre class="r"><code># ggmap isn&#39;t smart enough to reproject, so we need to by hand
trees_park_projected &lt;- st_transform(trees_in_park, sf::st_crs(4326))</code></pre>
<p>Now, we can use our re-projected trees and our basemap:</p>
<pre class="r"><code>ggmap(park_base_map) + 
  geom_sf(data=trees_park_projected, inherit.aes = FALSE) # note - this is needed due to a slight quirk between ggmap, ggplot, and geom_sf</code></pre>
<p><img src="08-maps_files/figure-html/unnamed-chunk-24-1.png" width="672" /></p>
<p><code>geom_sf</code> still work the way we’ve been using it; now that
we have our points on a map, let’s color by the type of tree:</p>
<pre class="r"><code>ggmap(park_base_map) + 
  geom_sf(data=trees_park_projected, inherit.aes = FALSE, 
          alpha=0.5, 
          mapping=aes(color=Genus)) # just like any other ggplot geom</code></pre>
<pre><code>## Coordinate system already present. Adding new coordinate system, which will
## replace the existing one.</code></pre>
<p><img src="08-maps_files/figure-html/unnamed-chunk-25-1.png" width="672" /></p>
<p>Clearly, there are too many levels for this variable to be truly
useful; we would want to do some sort of additional categorizing. But it
<em>is</em> enough to see that there are some general patterns of what
kinds of trees were inventoried in which part of the park!</p>
</div>
<div id="ggspatial" class="section level2" number="4.4">
<h2><span class="header-section-number">4.4</span>
<code>ggspatial</code></h2>
<p><code>ggspatial</code> is another extension to <code>ggplot</code>
that makes OpenStreetMap base data easy to work with. Unlike
<code>ggmap</code>, it <em>is</em> able to automatically deal with
projections:</p>
<pre class="r"><code># look, Ma, no re-projection needed!
ggplot() + annotation_map_tile(type=&quot;osm&quot;) + layer_spatial(trees_in_park)</code></pre>
<p><img src="08-maps_files/figure-html/unnamed-chunk-26-1.png" width="672" /></p>
<p><code>ggspatial</code> has several other handy features for
annotating geodata that go beyond what <code>geom_sf</code> has to
offer.</p>
<div class="panel panel-success">
<div class="panel-heading">
Challenge #6:
</div>
<div class="panel-body">
<p>Using either <code>ggmap</code> or <code>ggspatial</code>, take your
local park’s tree map (from challenge #5) and place it on a
OpenStreetMap raster tile. Use at least one aesthetic mapping (color,
point shape, etc.) to visualize at least one type of data about the
trees (other than genus).</p>
<p>Feel free to experiment with different map tile styles!</p>
</div>
</div>
</div>
<div id="interactive-map" class="section level2" number="4.5">
<h2><span class="header-section-number">4.5</span> Interactive Map</h2>
<p>What about interactivity? <a href="https://leafletjs.com">Leaflet</a>
is a powerful library for interactive maps, and has excellent R
integration. We will also use the <code>leaflet.esri</code> extension,
so we can use ESRI’s aerial photos.</p>
<pre class="r"><code>library(leaflet)
library(leaflet.esri)</code></pre>
<pre><code>## Loading required package: leaflet.extras</code></pre>
<p>As with <code>ggmap</code>, Leaflet wants things in WGS84 and will
not automatically reproject our data for us, so we will need to work
with <code>trees_park_projected</code>:</p>
<pre class="r"><code># now make a map with leaflet!
leaflet(trees_park_projected) %&gt;% # we can pass in a dataframe to use...
  addEsriBasemapLayer(esriBasemapLayers$Imagery) %&gt;%
  setView(-122.719, 45.474, zoom=16) %&gt;%
  addCircleMarkers()</code></pre>
<div class="leaflet html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-a38709909a28998429b2" style="width:672px;height:480px;"></div>
<script type="application/json" data-for="htmlwidget-a38709909a28998429b2">{"x":{"options":{"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}}},"calls":[{"method":"addEsriBasemapLayer","args":["Imagery",null,null,null,[]]},{"method":"addCircleMarkers","args":[[45.4741211611286,45.4746882602572,45.4757588678177,45.4755461671587,45.4754820387804,45.4752672327975,45.4760736688392,45.4747994394419,45.4756096565309,45.4747559891622,45.4732940477986,45.4740970996993,45.4754060167037,45.4758942470094,45.4754795507412,45.4753241673277,45.4743900569388,45.4728862969041,45.4748585924657,45.4744512283125,45.4744895824132,45.4745364023345,45.4754839864875,45.4747659966384,45.4742059058394,45.4752981836443,45.4758472111508,45.4737455675372,45.4754920007269,45.4760810933935,45.4757173999436,45.473708882324,45.4753544865219,45.4738842247994,45.4760867567584,45.4731810907774,45.4760940691521,45.4739835152063,45.4743751646881,45.4747639093601,45.4756273950616,45.4744122004964,45.4753469115484,45.4752360877999,45.4752728619985,45.4759498377802,45.4738785833151,45.4739703619997,45.4736844533093,45.4748137351007,45.4739213628814,45.4740812062849,45.4756828699085,45.473970228156,45.4759260303116,45.473656062945,45.4732493394691,45.4739801150397,45.4756376887332,45.4759604198964,45.4753483518379,45.4747770212938,45.4753217593689,45.4741439504821,45.4739916948228,45.4756761628187,45.4736361113791,45.475445228285,45.4757362849111,45.4751706451195,45.4739996082354,45.4753037716972,45.4735134261854,45.4755464449959,45.4747691152161,45.4748802897227,45.4755250779904,45.4760718804522,45.474207529245,45.4743106365276,45.4740552484194,45.4754887690645,45.47411910478,45.4755042235066,45.4740302673662,45.475310992248,45.4753543627626,45.4739500260036,45.4760726066019,45.4730737186576,45.4760491600233,45.476073469169,45.4736534221305,45.4750744215747,45.4739740304546,45.4748684017891,45.4736063606699,45.4761040454018,45.4758386792156,45.4750982273226,45.4737670112917,45.4739826997836,45.4736075347609,45.4739952204155,45.4761081615864,45.4748505519858,45.4750539854815,45.4736732291275,45.4761040451933,45.4749014671234,45.4757178498708,45.4739942969019,45.4740021765995,45.4759031145625,45.4755438523433,45.4749749993814,45.4740033549228,45.4740672878434,45.473317769845,45.4748419490276,45.4760382413763,45.4760354029012,45.4760265994015,45.474950602936,45.4750956623904,45.4749431287068,45.4760556524122,45.4760850707049,45.4728442583524,45.4753035130405,45.4750571924875,45.4749751485271,45.4751372356396,45.4756239663444,45.4737466355795,45.4748670791978,45.4738676685521,45.474792100906,45.4757170456816,45.4739887202392,45.4757710735773,45.4735145830693,45.4752999103531,45.474329336384,45.4752643094289,45.4759465499266,45.4754056366925,45.4741512867474,45.474002524973,45.4735450045744,45.4742200541182,45.4755116856725,45.4740068242555,45.4735321172675,45.4760357892946,45.4760174095159,45.4749954888618,45.4748337792039,45.4751449894376,45.4756377392416,45.4739853735813,45.4734001472238,45.4761094007654,45.4742303105128,45.4755589357103,45.47399085417,45.4734243042817,45.4759800870252,45.47399790083,45.4736419159832,45.4758893111392,45.4758418445403,45.4736399694505,45.4750362570555,45.4753826886285,45.4735426893931,45.4740054852166,45.4760368113774,45.4760363229968,45.4760375271325,45.4752191994158,45.4747844783679,45.4759726212126,45.4735566362355,45.4751508336516,45.4751541637137,45.4751606524103,45.4751589038823,45.4760948145027,45.4751656617958,45.4760382883467,45.476071914043,45.4760704781511,45.4753102304944,45.476055047347,45.4760432871661,45.476050091024,45.4754141738057,45.4735490218413,45.4735421525209,45.4735823843375,45.4758718715799,45.4751635201912,45.4751674200882,45.4751675695461,45.4751751063749,45.4758430748485,45.4759045948109,45.4748586125728,45.475167466103,45.4751760470026,45.4760849446239,45.4760679369206,45.4750749113697,45.4754900035475,45.4760424379795,45.4749129786009,45.4760462669386,45.4759598077234,45.4753786642345,45.4752560175305,45.4756483623567,45.4753147520612,45.475379143201,45.4754800134234,45.4753732568366,45.4753744122135,45.4744083938085,45.4752055925205,45.4742855454877,45.4756135105101,45.4760468324091,45.4751629406964,45.4751654415268,45.476056984361,45.4751683160529,45.4751709920658,45.475174861338,45.4760829331484,45.4760881664599,45.475006706637,45.4751566910049,45.4760664332266,45.476044923914,45.4750109401414,45.476049503185,45.4754343421154,45.4753562064339,45.4760470005314,45.4760234876913,45.4752554561304,45.4752132584501,45.4755594935821,45.4755594967276,45.4751708560777,45.47508159674,45.4748042533246,45.4753190795461,45.4753983727484,45.4740055350257,45.4755619606673,45.4755534753241,45.4756022865968,45.4751684867045,45.4751679762087,45.4751689935861,45.4760835420937,45.4751932343755,45.4760827274484,45.4749190419024,45.4753671141544,45.4752478453915,45.4760340320072,45.4760435175558,45.4749505940613,45.4760486475091,45.4749446668661,45.4753288817709,45.4759965236074,45.4753712272753,45.4753176241245,45.4756047255384,45.4752096677978,45.4752066319435,45.4752048587081,45.4753063369945,45.4737291390261,45.475658587643,45.4759206429539,45.47589037969,45.4753346036186,45.4752236837601,45.474926302786,45.4754819364642,45.4746613209573,45.4753119558403,45.4752130726405,45.4753218245069,45.4753863351905,45.474145874838,45.4754834464052,45.4754761582165,45.47387625638,45.4756159120008,45.4759466177984,45.4760486886896,45.4760709080161,45.4760709078812,45.4756035473846,45.475842132207,45.4760122521808,45.4759933433754,45.475779293597,45.4759481579174,45.4751664499848,45.4750400648895,45.4757860022445,45.4757945144856,45.4758327289842,45.4760511481783,45.4760626060732,45.4758834866187,45.4760522992982,45.4758882671693,45.4757707696076,45.4758559683589,45.4756199788871,45.4755481523789,45.4754647169431,45.4757493267291,45.4758253475499,45.4752279871451,45.475714234982,45.4755897549687,45.4756895066188,45.4749860655141,45.4750188150372,45.4749587109533,45.4760695735556,45.4760845390778,45.4760869867791,45.4759576449679,45.4757183338182,45.4760631023058,45.4760592944779,45.4759686595694,45.476007263591,45.4759046460938,45.4754875682775,45.4759819381187,45.4756379893483,45.4759532455334,45.4753751962016,45.4752081449417,45.4751335510656,45.4758336513902,45.4751567722972,45.4751783436261,45.4749568770309,45.4757353474919,45.4760071493649,45.4757393800262,45.4758169040718,45.4750623417289,45.475766398134,45.475763995927,45.4757940173361,45.4757564271597,45.4758478067804,45.4747907594902,45.4742804683693,45.4740245186292,45.4741759152334,45.474132424147,45.4740934043851,45.4736372925172,45.4737703834946,45.4750952302294,45.4736759101065,45.4737054612105,45.4735952006855,45.475272735689,45.4752477776245,45.4735689951369,45.4758369112694,45.4757163245928,45.4758184608482,45.4759014676884,45.4748681782461,45.4748608146009,45.4739447195303,45.473552517763,45.4735421821925,45.4737740183008,45.4739290310324,45.4752087769913,45.4737372776544,45.4737942884617,45.473741295793,45.4735996153455,45.473602784255,45.475352862868,45.4735410261626,45.4750180771472,45.4745491834114,45.4744089602065,45.4745014665261,45.4736904335651,45.4739734440291,45.4739425556009,45.4739664804046,45.4735414450146,45.4739023718389,45.4735456533561,45.4735487833988,45.4755775213466,45.4735944853485,45.4736183475142,45.4749119289082,45.4748069238638,45.4741334366818,45.4742558872458,45.4740465228068,45.4736557377021,45.4735582374891,45.4738375092475,45.4738571186395,45.4750151809655,45.4736870305609,45.4738375023811,45.4756210775724,45.4736040810215,45.4756162656615,45.4736024756059,45.4736220842215,45.4756136414383,45.4736316386485,45.4736161302793,45.4755830283823,45.473603589158,45.4736053592829,45.4736183475142,45.4738080103505,45.4751816821996,45.4750760710854,45.4742532306512,45.4742006450622,45.473849441641,45.4735495798034,45.4735663233861,45.473741771987,45.4751860647716,45.4735956366608,45.4735649334199,45.4751713478789,45.4738386807994,45.4752910157624,45.4751555971025,45.4736243709189,45.4735853120997,45.4735649872643,45.4735826328563,45.4755673656665,45.4755641923547,45.4755750619184,45.4755701212584,45.4755549688421,45.475577367099,45.4755921902692,45.4755542521674,45.4736237111912,45.4736422978424,45.4736403233707,45.4755872492932,45.4755806609117,45.4736540586569,45.4736283226338,45.4736069501471,45.4736177506929,45.4736479727019,45.4755822465988,45.4755761341635,45.4755885668928,45.4755491113098,45.4736074267221,45.4736356974995,45.4736377818964,45.4756109239327,45.4755715304823,45.4755969874646,45.4755559570879,45.4750694688404,45.4749121422967,45.4750294356653,45.4748425187716,45.4737119142913,45.4737507146534,45.473808891991,45.4732171528733,45.4732477602609,45.4732741247126,45.4734373635316,45.4749898291436,45.4749184148243,45.4750200271481,45.4749428769912,45.4748594544384,45.4735671190402,45.4735347977219,45.4736606330127,45.4738450908073,45.4728423871073,45.4733541081486,45.4732177472354,45.4732587496065,45.4734901213761,45.4748356191365,45.4748864252786,45.4749642034202,45.4735115277101,45.4736127985717,45.473555930581,45.4735619633061,45.473544294617,45.4731602905742,45.4732030123914,45.4732273569412,45.4732454262794,45.47324978,45.4735615164844,45.4735395386543,45.4735929747395,45.4737045886105,45.4737360466484,45.4736860742556,45.4731779290466,45.4731565081864,45.4734123324973,45.4734537769565,45.4734924321655,45.4734653892937,45.4730578942081,45.4703894013426,45.472992963174,45.4729554886795,45.4692668161406,45.4727556118584,45.4691826811234,45.469130150779,45.4727825517421,45.4700412345755,45.4705912884663,45.4706584497963,45.4727854781808,45.4704638538402,45.4728227027926,45.4703612408741,45.4726665682057,45.4705805598673,45.4708064490601,45.4728272229133,45.4728156994957,45.470933071957,45.4726781132632,45.4716045642175,45.471136831809,45.471095092699,45.4733839182607,45.4732305481797,45.469130475242,45.4729255431921,45.4731549977803,45.4726753310451,45.4715686733199,45.471604191686,45.47106409735,45.4708884610381,45.4732951249443,45.4732843009346,45.473225295201,45.4703401668896,45.4728181658779,45.4691203374134,45.4691634651103,45.4726764823039,45.4703645455918,45.470423670889,45.4707384461207,45.4705661816838,45.4705384823501,45.4731393757689,45.4705037245514,45.4703092713124,45.4702724249446,45.4691172454087,45.4727556118584,45.4692813227355,45.4726704811488,45.4691204937802,45.4691286233038,45.4699451926939,45.4728432530504,45.4730463618896,45.4726945348019,45.4707722466368,45.4708417429792,45.4710344456225,45.4714870441202,45.4717560348411,45.4717092423157,45.4728180866037,45.4708856416752,45.4709118491098,45.471233145243,45.4727657842652,45.4726613873605,45.475970182354,45.471934590138],[-122.721568563546,-122.718150929811,-122.71850216735,-122.719039267321,-122.717147456302,-122.717083084475,-122.721348810473,-122.720500980957,-122.717240194243,-122.720267771457,-122.722957748211,-122.722269791198,-122.715607050751,-122.718187494149,-122.718941394164,-122.718663323093,-122.721762288241,-122.721529472923,-122.719607649964,-122.721989100819,-122.721915095746,-122.718039132818,-122.719122160239,-122.720582345677,-122.721990262389,-122.718446761736,-122.718582068413,-122.718154101207,-122.719410650573,-122.721540815905,-122.720170937407,-122.718164501727,-122.717001771828,-122.722088758783,-122.721920653538,-122.722951872306,-122.722121241585,-122.720845333263,-122.718020883979,-122.720683554726,-122.719808501419,-122.721967360272,-122.718542894078,-122.716929799913,-122.718182077658,-122.718461977798,-122.720584018538,-122.722055932065,-122.718168738953,-122.720398545873,-122.720584560436,-122.722145428032,-122.720243648779,-122.720587543388,-122.718387137306,-122.718166855421,-122.722966764654,-122.72072528336,-122.717119482939,-122.718303649395,-122.719385743988,-122.720131741797,-122.71955222256,-122.72222212434,-122.72101658629,-122.718171265728,-122.71827400812,-122.716011105354,-122.718087583594,-122.71954711475,-122.72124945978,-122.720568027078,-122.722355410681,-122.720445284754,-122.721985007416,-122.721265305007,-122.720387355796,-122.721132772166,-122.718135852547,-122.721949001297,-122.718040958469,-122.719251347778,-122.721955394596,-122.719544605757,-122.721958300448,-122.718113517366,-122.717858323901,-122.722169410152,-122.719540268085,-122.722941431026,-122.718383706664,-122.719328621165,-122.718210167019,-122.717857859171,-122.720660750957,-122.720216848689,-122.718070914706,-122.722326868978,-122.718364007391,-122.717385147938,-122.7223848575,-122.72079306832,-122.718173446573,-122.722268048733,-122.722538191427,-122.719789789735,-122.716995938848,-122.7182398253,-122.722936187119,-122.719764178755,-122.716755205187,-122.721134554062,-122.72131156203,-122.716790174782,-122.715731381585,-122.719255428503,-122.721440755284,-122.722880145399,-122.72233412909,-122.719148148425,-122.716552156813,-122.71615717014,-122.715949535344,-122.715719705102,-122.719403307292,-122.719528894349,-122.718182240686,-122.721773018291,-122.722637499628,-122.717781878873,-122.717981879698,-122.717905829606,-122.717510005651,-122.720339225737,-122.721978640388,-122.720043325121,-122.722284320335,-122.719966868874,-122.718281013264,-122.720962770675,-122.716892650876,-122.722954540067,-122.719489868764,-122.722132642829,-122.7196244646,-122.71691828505,-122.71580183719,-122.722776030811,-122.721383811992,-122.718357426784,-122.7228508895,-122.72047943661,-122.721550679721,-122.718741087566,-122.715792267843,-122.715603173517,-122.71594831404,-122.721818052155,-122.720548459304,-122.716942760903,-122.720902594355,-122.722953443926,-122.722720714581,-122.722172160129,-122.720500260555,-122.721075812091,-122.7227808803,-122.721005249107,-122.721194919592,-122.718355428023,-122.720966394245,-122.718095867506,-122.718435944008,-122.719581492883,-122.720632484755,-122.718557963233,-122.721495392627,-122.716943707891,-122.716747233491,-122.716355596858,-122.720559857601,-122.721776410522,-122.718090668315,-122.722253405323,-122.721590805346,-122.721633261279,-122.721695770149,-122.721760446878,-122.722933828693,-122.721935742433,-122.722625907576,-122.721870633899,-122.721846359053,-122.721291611374,-122.721887054675,-122.7217961778,-122.72166428766,-122.722893713082,-122.722177870155,-122.722068722011,-122.721857890517,-122.722708465318,-122.72199039685,-122.722045773713,-122.72244864585,-122.722573330792,-122.72262858238,-122.722635982596,-122.719406625124,-122.722101392688,-122.722630991028,-122.722303795669,-122.721909897758,-122.721244131646,-122.722777322089,-122.721867873019,-122.720716948075,-122.721464350594,-122.721388547538,-122.722515572083,-122.722999758905,-122.721379213115,-122.722320652155,-122.722317238588,-122.721620798276,-122.722172332566,-122.721607040205,-122.722976117312,-122.722178073276,-122.722975734799,-122.72258694261,-122.722667824791,-122.72182587184,-122.721875122772,-122.722625991412,-122.722283408795,-122.722392609776,-122.722507172472,-122.722551257631,-122.722352201716,-122.721214629524,-122.72125473404,-122.721831170408,-122.721812865276,-122.720568190434,-122.721547385948,-122.722988008136,-122.722993914404,-122.721442766958,-122.721381084838,-122.72287770469,-122.722518986981,-122.721461854946,-122.721797461722,-122.722853632935,-122.722998460482,-122.722984821671,-122.721608038602,-122.721817410966,-122.722970497887,-122.722104849301,-122.72225740435,-122.722301309186,-122.722155212418,-122.722213396777,-122.72233829885,-122.722589504485,-122.722658179596,-122.722578018378,-122.719073835609,-122.721255533077,-122.721287002728,-122.721872668805,-122.721833392592,-122.7205920107,-122.721581557813,-122.72038762089,-122.722873766148,-122.721382113814,-122.722716099026,-122.722520351207,-122.721369335078,-122.722317580213,-122.721599238403,-122.72198581538,-122.721975252099,-122.722963434602,-122.722601092623,-122.721387278813,-122.721392356424,-122.722721902076,-122.722785117145,-122.722992615762,-122.722305291688,-122.722992163328,-122.7221721745,-122.721822707565,-122.721812136655,-122.721972083748,-122.722976687643,-122.721959907648,-122.721804664512,-122.722973246761,-122.716763171479,-122.71796178647,-122.717160541037,-122.720519631926,-122.720702913733,-122.717856792371,-122.720748406216,-122.717879141596,-122.717889841156,-122.717323892153,-122.71727682366,-122.720156910958,-122.720185486912,-122.716220080003,-122.716067579809,-122.716032968747,-122.719040500699,-122.717764058137,-122.717666763389,-122.72013186775,-122.72070764621,-122.71788052838,-122.717842434654,-122.720585652588,-122.720580501735,-122.720446581009,-122.717504117421,-122.717211146199,-122.720280262264,-122.716599801117,-122.716493717514,-122.716418637251,-122.720098177055,-122.720029696025,-122.719953862891,-122.717963211555,-122.720318300313,-122.720842436241,-122.720824914957,-122.71776806031,-122.717561700414,-122.71735253535,-122.717765191036,-122.720850983255,-122.720786518282,-122.720549098494,-122.717938208167,-122.717425012436,-122.717497287722,-122.720441026835,-122.720433231374,-122.720437539406,-122.716639821062,-122.720358730324,-122.720071095358,-122.720111126464,-122.715965171447,-122.717894549945,-122.717277917883,-122.717090736063,-122.720341785067,-122.716327752448,-122.716274761339,-122.716144213218,-122.715867546882,-122.715774366475,-122.715630789671,-122.715860631767,-122.715728234465,-122.716026571133,-122.715963699794,-122.71597319957,-122.715964922455,-122.716299902864,-122.719914764436,-122.717866612458,-122.717596665658,-122.716357066602,-122.719310876514,-122.719209482971,-122.716525268293,-122.715960025794,-122.715837912004,-122.715930756613,-122.715601112163,-122.715907191195,-122.715720828202,-122.716312991989,-122.71617922563,-122.71617464129,-122.716268014544,-122.717794921508,-122.719927057582,-122.717789140895,-122.717305325581,-122.717112736922,-122.716877963382,-122.716818139208,-122.719213247811,-122.716294164103,-122.715792487947,-122.715858526245,-122.715732911708,-122.715587318578,-122.715797871678,-122.716007004238,-122.715991039791,-122.716236988196,-122.716161394462,-122.716360676592,-122.716166989879,-122.71626691223,-122.719855765492,-122.716435103622,-122.716315213665,-122.715602334349,-122.715795675227,-122.715838673542,-122.716076647718,-122.71591375308,-122.715623215935,-122.716179226065,-122.716316578302,-122.716263333035,-122.719825514638,-122.717724602706,-122.717502470483,-122.719875822799,-122.716917126564,-122.719935715314,-122.716713753981,-122.716638646903,-122.71995630241,-122.716564148145,-122.716393785808,-122.719953496849,-122.716376758383,-122.716388442354,-122.716315213665,-122.716176737766,-122.719049269112,-122.718964568875,-122.716293492988,-122.716066623393,-122.715798635278,-122.716345400939,-122.716439806285,-122.716231882625,-122.719143316884,-122.716487977397,-122.716475619132,-122.71926015126,-122.716191122593,-122.71910019169,-122.718951543662,-122.718141434004,-122.718695646624,-122.718888921504,-122.718923930732,-122.719968279968,-122.720099053204,-122.720047852385,-122.720117842783,-122.720167635133,-122.720162468412,-122.720152604229,-122.720206556542,-122.718217229086,-122.718510589103,-122.718578058611,-122.720105629901,-122.720177500782,-122.718613162057,-122.718682885883,-122.718853378876,-122.718908745752,-122.718905237873,-122.720001561637,-122.719971406728,-122.720163877134,-122.720191936945,-122.718743067049,-122.718786303499,-122.718849109187,-122.719978315068,-122.71998109826,-122.720082166771,-122.720137572112,-122.718760490325,-122.718684730483,-122.71860959383,-122.718424433254,-122.719279751225,-122.71952886965,-122.719647476029,-122.720718595457,-122.718942117225,-122.71812177249,-122.718252856584,-122.718992108652,-122.718868102387,-122.718471841029,-122.718544294722,-122.718162346336,-122.719040693638,-122.719070192278,-122.719319696965,-122.719561439714,-122.720471065978,-122.718694533228,-122.718412296359,-122.718163798595,-122.717872057517,-122.718885098192,-122.718289364819,-122.718182024467,-122.719131031542,-122.719322154703,-122.71933221532,-122.71926461653,-122.719267688128,-122.719478111775,-122.718471680068,-122.718356566261,-122.718234973918,-122.718186638552,-122.719011811132,-122.719215223693,-122.719175893069,-122.719195559239,-122.719375005492,-122.719468029608,-122.7189951055,-122.718727359086,-122.717956900969,-122.715640210535,-122.716076986241,-122.71606172202,-122.715627267947,-122.71980159012,-122.715768882534,-122.715582880702,-122.719930379988,-122.71564017184,-122.72018184895,-122.720359326882,-122.715915282198,-122.721933789234,-122.721782631947,-122.721718785363,-122.716260084057,-122.721926697665,-122.716394488983,-122.722201192072,-122.716346436455,-122.722205808262,-122.721657035647,-122.716787773816,-122.716933880523,-122.721853509589,-122.717154225313,-122.722783215549,-122.720538591974,-122.720331745855,-122.715566392676,-122.71563595704,-122.719655514879,-122.716038264816,-122.715959268361,-122.716924787608,-122.722590304868,-122.72242013057,-122.720110166513,-122.720325263097,-122.715564512245,-122.715691579941,-122.715641949891,-122.719704153078,-122.715766862397,-122.719912480086,-122.719933332091,-122.716106086542,-122.721748253874,-122.721627108038,-122.720484375154,-122.720685901398,-122.720067325554,-122.715558277497,-122.719996714303,-122.719645006767,-122.719584027595,-122.719804198387,-122.71564017184,-122.720184046988,-122.715824861032,-122.720140153426,-122.720239570254,-122.721773227121,-122.716153835433,-122.716271357459,-122.716636677813,-122.721637176728,-122.721747429614,-122.722566682446,-122.722600853264,-122.722806654089,-122.72242522395,-122.716671433461,-122.721865728634,-122.721886912784,-122.722547575644,-122.717055743468,-122.717427977769,-122.717655742052,-122.722413127075],10,null,null,{"interactive":true,"className":"","stroke":true,"color":"#03F","weight":5,"opacity":0.5,"fill":true,"fillColor":"#03F","fillOpacity":0.2},null,null,null,null,null,{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]}],"setView":[[45.474,-122.719],16,[]],"limits":{"lat":[45.4691172454087,45.4761094007654],"lng":[-122.722999758905,-122.715558277497]}},"evals":[],"jsHooks":[]}</script>
<p>One nice thing about Leaflet maps is that we can allow the user to
see more information about individual data points, via the
<code>label</code> and related properties.</p>
<pre class="r"><code>leaflet(trees_park_projected) %&gt;%
  addEsriBasemapLayer(esriBasemapLayers$Imagery) %&gt;%
  setView(-122.719, 45.474, zoom=16) %&gt;%
  addCircleMarkers(label = ~Genus_spec) # we can refer to properties of the data frame this way</code></pre>
<div class="leaflet html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-88c9d2d30f2d6342dbb0" style="width:672px;height:480px;"></div>
<script type="application/json" data-for="htmlwidget-88c9d2d30f2d6342dbb0">{"x":{"options":{"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}}},"calls":[{"method":"addEsriBasemapLayer","args":["Imagery",null,null,null,[]]},{"method":"addCircleMarkers","args":[[45.4741211611286,45.4746882602572,45.4757588678177,45.4755461671587,45.4754820387804,45.4752672327975,45.4760736688392,45.4747994394419,45.4756096565309,45.4747559891622,45.4732940477986,45.4740970996993,45.4754060167037,45.4758942470094,45.4754795507412,45.4753241673277,45.4743900569388,45.4728862969041,45.4748585924657,45.4744512283125,45.4744895824132,45.4745364023345,45.4754839864875,45.4747659966384,45.4742059058394,45.4752981836443,45.4758472111508,45.4737455675372,45.4754920007269,45.4760810933935,45.4757173999436,45.473708882324,45.4753544865219,45.4738842247994,45.4760867567584,45.4731810907774,45.4760940691521,45.4739835152063,45.4743751646881,45.4747639093601,45.4756273950616,45.4744122004964,45.4753469115484,45.4752360877999,45.4752728619985,45.4759498377802,45.4738785833151,45.4739703619997,45.4736844533093,45.4748137351007,45.4739213628814,45.4740812062849,45.4756828699085,45.473970228156,45.4759260303116,45.473656062945,45.4732493394691,45.4739801150397,45.4756376887332,45.4759604198964,45.4753483518379,45.4747770212938,45.4753217593689,45.4741439504821,45.4739916948228,45.4756761628187,45.4736361113791,45.475445228285,45.4757362849111,45.4751706451195,45.4739996082354,45.4753037716972,45.4735134261854,45.4755464449959,45.4747691152161,45.4748802897227,45.4755250779904,45.4760718804522,45.474207529245,45.4743106365276,45.4740552484194,45.4754887690645,45.47411910478,45.4755042235066,45.4740302673662,45.475310992248,45.4753543627626,45.4739500260036,45.4760726066019,45.4730737186576,45.4760491600233,45.476073469169,45.4736534221305,45.4750744215747,45.4739740304546,45.4748684017891,45.4736063606699,45.4761040454018,45.4758386792156,45.4750982273226,45.4737670112917,45.4739826997836,45.4736075347609,45.4739952204155,45.4761081615864,45.4748505519858,45.4750539854815,45.4736732291275,45.4761040451933,45.4749014671234,45.4757178498708,45.4739942969019,45.4740021765995,45.4759031145625,45.4755438523433,45.4749749993814,45.4740033549228,45.4740672878434,45.473317769845,45.4748419490276,45.4760382413763,45.4760354029012,45.4760265994015,45.474950602936,45.4750956623904,45.4749431287068,45.4760556524122,45.4760850707049,45.4728442583524,45.4753035130405,45.4750571924875,45.4749751485271,45.4751372356396,45.4756239663444,45.4737466355795,45.4748670791978,45.4738676685521,45.474792100906,45.4757170456816,45.4739887202392,45.4757710735773,45.4735145830693,45.4752999103531,45.474329336384,45.4752643094289,45.4759465499266,45.4754056366925,45.4741512867474,45.474002524973,45.4735450045744,45.4742200541182,45.4755116856725,45.4740068242555,45.4735321172675,45.4760357892946,45.4760174095159,45.4749954888618,45.4748337792039,45.4751449894376,45.4756377392416,45.4739853735813,45.4734001472238,45.4761094007654,45.4742303105128,45.4755589357103,45.47399085417,45.4734243042817,45.4759800870252,45.47399790083,45.4736419159832,45.4758893111392,45.4758418445403,45.4736399694505,45.4750362570555,45.4753826886285,45.4735426893931,45.4740054852166,45.4760368113774,45.4760363229968,45.4760375271325,45.4752191994158,45.4747844783679,45.4759726212126,45.4735566362355,45.4751508336516,45.4751541637137,45.4751606524103,45.4751589038823,45.4760948145027,45.4751656617958,45.4760382883467,45.476071914043,45.4760704781511,45.4753102304944,45.476055047347,45.4760432871661,45.476050091024,45.4754141738057,45.4735490218413,45.4735421525209,45.4735823843375,45.4758718715799,45.4751635201912,45.4751674200882,45.4751675695461,45.4751751063749,45.4758430748485,45.4759045948109,45.4748586125728,45.475167466103,45.4751760470026,45.4760849446239,45.4760679369206,45.4750749113697,45.4754900035475,45.4760424379795,45.4749129786009,45.4760462669386,45.4759598077234,45.4753786642345,45.4752560175305,45.4756483623567,45.4753147520612,45.475379143201,45.4754800134234,45.4753732568366,45.4753744122135,45.4744083938085,45.4752055925205,45.4742855454877,45.4756135105101,45.4760468324091,45.4751629406964,45.4751654415268,45.476056984361,45.4751683160529,45.4751709920658,45.475174861338,45.4760829331484,45.4760881664599,45.475006706637,45.4751566910049,45.4760664332266,45.476044923914,45.4750109401414,45.476049503185,45.4754343421154,45.4753562064339,45.4760470005314,45.4760234876913,45.4752554561304,45.4752132584501,45.4755594935821,45.4755594967276,45.4751708560777,45.47508159674,45.4748042533246,45.4753190795461,45.4753983727484,45.4740055350257,45.4755619606673,45.4755534753241,45.4756022865968,45.4751684867045,45.4751679762087,45.4751689935861,45.4760835420937,45.4751932343755,45.4760827274484,45.4749190419024,45.4753671141544,45.4752478453915,45.4760340320072,45.4760435175558,45.4749505940613,45.4760486475091,45.4749446668661,45.4753288817709,45.4759965236074,45.4753712272753,45.4753176241245,45.4756047255384,45.4752096677978,45.4752066319435,45.4752048587081,45.4753063369945,45.4737291390261,45.475658587643,45.4759206429539,45.47589037969,45.4753346036186,45.4752236837601,45.474926302786,45.4754819364642,45.4746613209573,45.4753119558403,45.4752130726405,45.4753218245069,45.4753863351905,45.474145874838,45.4754834464052,45.4754761582165,45.47387625638,45.4756159120008,45.4759466177984,45.4760486886896,45.4760709080161,45.4760709078812,45.4756035473846,45.475842132207,45.4760122521808,45.4759933433754,45.475779293597,45.4759481579174,45.4751664499848,45.4750400648895,45.4757860022445,45.4757945144856,45.4758327289842,45.4760511481783,45.4760626060732,45.4758834866187,45.4760522992982,45.4758882671693,45.4757707696076,45.4758559683589,45.4756199788871,45.4755481523789,45.4754647169431,45.4757493267291,45.4758253475499,45.4752279871451,45.475714234982,45.4755897549687,45.4756895066188,45.4749860655141,45.4750188150372,45.4749587109533,45.4760695735556,45.4760845390778,45.4760869867791,45.4759576449679,45.4757183338182,45.4760631023058,45.4760592944779,45.4759686595694,45.476007263591,45.4759046460938,45.4754875682775,45.4759819381187,45.4756379893483,45.4759532455334,45.4753751962016,45.4752081449417,45.4751335510656,45.4758336513902,45.4751567722972,45.4751783436261,45.4749568770309,45.4757353474919,45.4760071493649,45.4757393800262,45.4758169040718,45.4750623417289,45.475766398134,45.475763995927,45.4757940173361,45.4757564271597,45.4758478067804,45.4747907594902,45.4742804683693,45.4740245186292,45.4741759152334,45.474132424147,45.4740934043851,45.4736372925172,45.4737703834946,45.4750952302294,45.4736759101065,45.4737054612105,45.4735952006855,45.475272735689,45.4752477776245,45.4735689951369,45.4758369112694,45.4757163245928,45.4758184608482,45.4759014676884,45.4748681782461,45.4748608146009,45.4739447195303,45.473552517763,45.4735421821925,45.4737740183008,45.4739290310324,45.4752087769913,45.4737372776544,45.4737942884617,45.473741295793,45.4735996153455,45.473602784255,45.475352862868,45.4735410261626,45.4750180771472,45.4745491834114,45.4744089602065,45.4745014665261,45.4736904335651,45.4739734440291,45.4739425556009,45.4739664804046,45.4735414450146,45.4739023718389,45.4735456533561,45.4735487833988,45.4755775213466,45.4735944853485,45.4736183475142,45.4749119289082,45.4748069238638,45.4741334366818,45.4742558872458,45.4740465228068,45.4736557377021,45.4735582374891,45.4738375092475,45.4738571186395,45.4750151809655,45.4736870305609,45.4738375023811,45.4756210775724,45.4736040810215,45.4756162656615,45.4736024756059,45.4736220842215,45.4756136414383,45.4736316386485,45.4736161302793,45.4755830283823,45.473603589158,45.4736053592829,45.4736183475142,45.4738080103505,45.4751816821996,45.4750760710854,45.4742532306512,45.4742006450622,45.473849441641,45.4735495798034,45.4735663233861,45.473741771987,45.4751860647716,45.4735956366608,45.4735649334199,45.4751713478789,45.4738386807994,45.4752910157624,45.4751555971025,45.4736243709189,45.4735853120997,45.4735649872643,45.4735826328563,45.4755673656665,45.4755641923547,45.4755750619184,45.4755701212584,45.4755549688421,45.475577367099,45.4755921902692,45.4755542521674,45.4736237111912,45.4736422978424,45.4736403233707,45.4755872492932,45.4755806609117,45.4736540586569,45.4736283226338,45.4736069501471,45.4736177506929,45.4736479727019,45.4755822465988,45.4755761341635,45.4755885668928,45.4755491113098,45.4736074267221,45.4736356974995,45.4736377818964,45.4756109239327,45.4755715304823,45.4755969874646,45.4755559570879,45.4750694688404,45.4749121422967,45.4750294356653,45.4748425187716,45.4737119142913,45.4737507146534,45.473808891991,45.4732171528733,45.4732477602609,45.4732741247126,45.4734373635316,45.4749898291436,45.4749184148243,45.4750200271481,45.4749428769912,45.4748594544384,45.4735671190402,45.4735347977219,45.4736606330127,45.4738450908073,45.4728423871073,45.4733541081486,45.4732177472354,45.4732587496065,45.4734901213761,45.4748356191365,45.4748864252786,45.4749642034202,45.4735115277101,45.4736127985717,45.473555930581,45.4735619633061,45.473544294617,45.4731602905742,45.4732030123914,45.4732273569412,45.4732454262794,45.47324978,45.4735615164844,45.4735395386543,45.4735929747395,45.4737045886105,45.4737360466484,45.4736860742556,45.4731779290466,45.4731565081864,45.4734123324973,45.4734537769565,45.4734924321655,45.4734653892937,45.4730578942081,45.4703894013426,45.472992963174,45.4729554886795,45.4692668161406,45.4727556118584,45.4691826811234,45.469130150779,45.4727825517421,45.4700412345755,45.4705912884663,45.4706584497963,45.4727854781808,45.4704638538402,45.4728227027926,45.4703612408741,45.4726665682057,45.4705805598673,45.4708064490601,45.4728272229133,45.4728156994957,45.470933071957,45.4726781132632,45.4716045642175,45.471136831809,45.471095092699,45.4733839182607,45.4732305481797,45.469130475242,45.4729255431921,45.4731549977803,45.4726753310451,45.4715686733199,45.471604191686,45.47106409735,45.4708884610381,45.4732951249443,45.4732843009346,45.473225295201,45.4703401668896,45.4728181658779,45.4691203374134,45.4691634651103,45.4726764823039,45.4703645455918,45.470423670889,45.4707384461207,45.4705661816838,45.4705384823501,45.4731393757689,45.4705037245514,45.4703092713124,45.4702724249446,45.4691172454087,45.4727556118584,45.4692813227355,45.4726704811488,45.4691204937802,45.4691286233038,45.4699451926939,45.4728432530504,45.4730463618896,45.4726945348019,45.4707722466368,45.4708417429792,45.4710344456225,45.4714870441202,45.4717560348411,45.4717092423157,45.4728180866037,45.4708856416752,45.4709118491098,45.471233145243,45.4727657842652,45.4726613873605,45.475970182354,45.471934590138],[-122.721568563546,-122.718150929811,-122.71850216735,-122.719039267321,-122.717147456302,-122.717083084475,-122.721348810473,-122.720500980957,-122.717240194243,-122.720267771457,-122.722957748211,-122.722269791198,-122.715607050751,-122.718187494149,-122.718941394164,-122.718663323093,-122.721762288241,-122.721529472923,-122.719607649964,-122.721989100819,-122.721915095746,-122.718039132818,-122.719122160239,-122.720582345677,-122.721990262389,-122.718446761736,-122.718582068413,-122.718154101207,-122.719410650573,-122.721540815905,-122.720170937407,-122.718164501727,-122.717001771828,-122.722088758783,-122.721920653538,-122.722951872306,-122.722121241585,-122.720845333263,-122.718020883979,-122.720683554726,-122.719808501419,-122.721967360272,-122.718542894078,-122.716929799913,-122.718182077658,-122.718461977798,-122.720584018538,-122.722055932065,-122.718168738953,-122.720398545873,-122.720584560436,-122.722145428032,-122.720243648779,-122.720587543388,-122.718387137306,-122.718166855421,-122.722966764654,-122.72072528336,-122.717119482939,-122.718303649395,-122.719385743988,-122.720131741797,-122.71955222256,-122.72222212434,-122.72101658629,-122.718171265728,-122.71827400812,-122.716011105354,-122.718087583594,-122.71954711475,-122.72124945978,-122.720568027078,-122.722355410681,-122.720445284754,-122.721985007416,-122.721265305007,-122.720387355796,-122.721132772166,-122.718135852547,-122.721949001297,-122.718040958469,-122.719251347778,-122.721955394596,-122.719544605757,-122.721958300448,-122.718113517366,-122.717858323901,-122.722169410152,-122.719540268085,-122.722941431026,-122.718383706664,-122.719328621165,-122.718210167019,-122.717857859171,-122.720660750957,-122.720216848689,-122.718070914706,-122.722326868978,-122.718364007391,-122.717385147938,-122.7223848575,-122.72079306832,-122.718173446573,-122.722268048733,-122.722538191427,-122.719789789735,-122.716995938848,-122.7182398253,-122.722936187119,-122.719764178755,-122.716755205187,-122.721134554062,-122.72131156203,-122.716790174782,-122.715731381585,-122.719255428503,-122.721440755284,-122.722880145399,-122.72233412909,-122.719148148425,-122.716552156813,-122.71615717014,-122.715949535344,-122.715719705102,-122.719403307292,-122.719528894349,-122.718182240686,-122.721773018291,-122.722637499628,-122.717781878873,-122.717981879698,-122.717905829606,-122.717510005651,-122.720339225737,-122.721978640388,-122.720043325121,-122.722284320335,-122.719966868874,-122.718281013264,-122.720962770675,-122.716892650876,-122.722954540067,-122.719489868764,-122.722132642829,-122.7196244646,-122.71691828505,-122.71580183719,-122.722776030811,-122.721383811992,-122.718357426784,-122.7228508895,-122.72047943661,-122.721550679721,-122.718741087566,-122.715792267843,-122.715603173517,-122.71594831404,-122.721818052155,-122.720548459304,-122.716942760903,-122.720902594355,-122.722953443926,-122.722720714581,-122.722172160129,-122.720500260555,-122.721075812091,-122.7227808803,-122.721005249107,-122.721194919592,-122.718355428023,-122.720966394245,-122.718095867506,-122.718435944008,-122.719581492883,-122.720632484755,-122.718557963233,-122.721495392627,-122.716943707891,-122.716747233491,-122.716355596858,-122.720559857601,-122.721776410522,-122.718090668315,-122.722253405323,-122.721590805346,-122.721633261279,-122.721695770149,-122.721760446878,-122.722933828693,-122.721935742433,-122.722625907576,-122.721870633899,-122.721846359053,-122.721291611374,-122.721887054675,-122.7217961778,-122.72166428766,-122.722893713082,-122.722177870155,-122.722068722011,-122.721857890517,-122.722708465318,-122.72199039685,-122.722045773713,-122.72244864585,-122.722573330792,-122.72262858238,-122.722635982596,-122.719406625124,-122.722101392688,-122.722630991028,-122.722303795669,-122.721909897758,-122.721244131646,-122.722777322089,-122.721867873019,-122.720716948075,-122.721464350594,-122.721388547538,-122.722515572083,-122.722999758905,-122.721379213115,-122.722320652155,-122.722317238588,-122.721620798276,-122.722172332566,-122.721607040205,-122.722976117312,-122.722178073276,-122.722975734799,-122.72258694261,-122.722667824791,-122.72182587184,-122.721875122772,-122.722625991412,-122.722283408795,-122.722392609776,-122.722507172472,-122.722551257631,-122.722352201716,-122.721214629524,-122.72125473404,-122.721831170408,-122.721812865276,-122.720568190434,-122.721547385948,-122.722988008136,-122.722993914404,-122.721442766958,-122.721381084838,-122.72287770469,-122.722518986981,-122.721461854946,-122.721797461722,-122.722853632935,-122.722998460482,-122.722984821671,-122.721608038602,-122.721817410966,-122.722970497887,-122.722104849301,-122.72225740435,-122.722301309186,-122.722155212418,-122.722213396777,-122.72233829885,-122.722589504485,-122.722658179596,-122.722578018378,-122.719073835609,-122.721255533077,-122.721287002728,-122.721872668805,-122.721833392592,-122.7205920107,-122.721581557813,-122.72038762089,-122.722873766148,-122.721382113814,-122.722716099026,-122.722520351207,-122.721369335078,-122.722317580213,-122.721599238403,-122.72198581538,-122.721975252099,-122.722963434602,-122.722601092623,-122.721387278813,-122.721392356424,-122.722721902076,-122.722785117145,-122.722992615762,-122.722305291688,-122.722992163328,-122.7221721745,-122.721822707565,-122.721812136655,-122.721972083748,-122.722976687643,-122.721959907648,-122.721804664512,-122.722973246761,-122.716763171479,-122.71796178647,-122.717160541037,-122.720519631926,-122.720702913733,-122.717856792371,-122.720748406216,-122.717879141596,-122.717889841156,-122.717323892153,-122.71727682366,-122.720156910958,-122.720185486912,-122.716220080003,-122.716067579809,-122.716032968747,-122.719040500699,-122.717764058137,-122.717666763389,-122.72013186775,-122.72070764621,-122.71788052838,-122.717842434654,-122.720585652588,-122.720580501735,-122.720446581009,-122.717504117421,-122.717211146199,-122.720280262264,-122.716599801117,-122.716493717514,-122.716418637251,-122.720098177055,-122.720029696025,-122.719953862891,-122.717963211555,-122.720318300313,-122.720842436241,-122.720824914957,-122.71776806031,-122.717561700414,-122.71735253535,-122.717765191036,-122.720850983255,-122.720786518282,-122.720549098494,-122.717938208167,-122.717425012436,-122.717497287722,-122.720441026835,-122.720433231374,-122.720437539406,-122.716639821062,-122.720358730324,-122.720071095358,-122.720111126464,-122.715965171447,-122.717894549945,-122.717277917883,-122.717090736063,-122.720341785067,-122.716327752448,-122.716274761339,-122.716144213218,-122.715867546882,-122.715774366475,-122.715630789671,-122.715860631767,-122.715728234465,-122.716026571133,-122.715963699794,-122.71597319957,-122.715964922455,-122.716299902864,-122.719914764436,-122.717866612458,-122.717596665658,-122.716357066602,-122.719310876514,-122.719209482971,-122.716525268293,-122.715960025794,-122.715837912004,-122.715930756613,-122.715601112163,-122.715907191195,-122.715720828202,-122.716312991989,-122.71617922563,-122.71617464129,-122.716268014544,-122.717794921508,-122.719927057582,-122.717789140895,-122.717305325581,-122.717112736922,-122.716877963382,-122.716818139208,-122.719213247811,-122.716294164103,-122.715792487947,-122.715858526245,-122.715732911708,-122.715587318578,-122.715797871678,-122.716007004238,-122.715991039791,-122.716236988196,-122.716161394462,-122.716360676592,-122.716166989879,-122.71626691223,-122.719855765492,-122.716435103622,-122.716315213665,-122.715602334349,-122.715795675227,-122.715838673542,-122.716076647718,-122.71591375308,-122.715623215935,-122.716179226065,-122.716316578302,-122.716263333035,-122.719825514638,-122.717724602706,-122.717502470483,-122.719875822799,-122.716917126564,-122.719935715314,-122.716713753981,-122.716638646903,-122.71995630241,-122.716564148145,-122.716393785808,-122.719953496849,-122.716376758383,-122.716388442354,-122.716315213665,-122.716176737766,-122.719049269112,-122.718964568875,-122.716293492988,-122.716066623393,-122.715798635278,-122.716345400939,-122.716439806285,-122.716231882625,-122.719143316884,-122.716487977397,-122.716475619132,-122.71926015126,-122.716191122593,-122.71910019169,-122.718951543662,-122.718141434004,-122.718695646624,-122.718888921504,-122.718923930732,-122.719968279968,-122.720099053204,-122.720047852385,-122.720117842783,-122.720167635133,-122.720162468412,-122.720152604229,-122.720206556542,-122.718217229086,-122.718510589103,-122.718578058611,-122.720105629901,-122.720177500782,-122.718613162057,-122.718682885883,-122.718853378876,-122.718908745752,-122.718905237873,-122.720001561637,-122.719971406728,-122.720163877134,-122.720191936945,-122.718743067049,-122.718786303499,-122.718849109187,-122.719978315068,-122.71998109826,-122.720082166771,-122.720137572112,-122.718760490325,-122.718684730483,-122.71860959383,-122.718424433254,-122.719279751225,-122.71952886965,-122.719647476029,-122.720718595457,-122.718942117225,-122.71812177249,-122.718252856584,-122.718992108652,-122.718868102387,-122.718471841029,-122.718544294722,-122.718162346336,-122.719040693638,-122.719070192278,-122.719319696965,-122.719561439714,-122.720471065978,-122.718694533228,-122.718412296359,-122.718163798595,-122.717872057517,-122.718885098192,-122.718289364819,-122.718182024467,-122.719131031542,-122.719322154703,-122.71933221532,-122.71926461653,-122.719267688128,-122.719478111775,-122.718471680068,-122.718356566261,-122.718234973918,-122.718186638552,-122.719011811132,-122.719215223693,-122.719175893069,-122.719195559239,-122.719375005492,-122.719468029608,-122.7189951055,-122.718727359086,-122.717956900969,-122.715640210535,-122.716076986241,-122.71606172202,-122.715627267947,-122.71980159012,-122.715768882534,-122.715582880702,-122.719930379988,-122.71564017184,-122.72018184895,-122.720359326882,-122.715915282198,-122.721933789234,-122.721782631947,-122.721718785363,-122.716260084057,-122.721926697665,-122.716394488983,-122.722201192072,-122.716346436455,-122.722205808262,-122.721657035647,-122.716787773816,-122.716933880523,-122.721853509589,-122.717154225313,-122.722783215549,-122.720538591974,-122.720331745855,-122.715566392676,-122.71563595704,-122.719655514879,-122.716038264816,-122.715959268361,-122.716924787608,-122.722590304868,-122.72242013057,-122.720110166513,-122.720325263097,-122.715564512245,-122.715691579941,-122.715641949891,-122.719704153078,-122.715766862397,-122.719912480086,-122.719933332091,-122.716106086542,-122.721748253874,-122.721627108038,-122.720484375154,-122.720685901398,-122.720067325554,-122.715558277497,-122.719996714303,-122.719645006767,-122.719584027595,-122.719804198387,-122.71564017184,-122.720184046988,-122.715824861032,-122.720140153426,-122.720239570254,-122.721773227121,-122.716153835433,-122.716271357459,-122.716636677813,-122.721637176728,-122.721747429614,-122.722566682446,-122.722600853264,-122.722806654089,-122.72242522395,-122.716671433461,-122.721865728634,-122.721886912784,-122.722547575644,-122.717055743468,-122.717427977769,-122.717655742052,-122.722413127075],10,null,null,{"interactive":true,"className":"","stroke":true,"color":"#03F","weight":5,"opacity":0.5,"fill":true,"fillColor":"#03F","fillOpacity":0.2},null,null,null,null,["Sequoiadendron giganteum","Platanus x acerifolia","Acer platanoides","Unknown (dead)","Acer platanoides","Pinus ponderosa","Quercus palustris","Pseudolarix amabilis","Pinus ponderosa","Cercis canadensis","Acer platanoides","Calocedrus decurrens","Acer platanoides","Acer platanoides","Acer platanoides","Picea pungens","Calocedrus decurrens","Fraxinus americana","Platanus x acerifolia","Calocedrus decurrens","Liquidambar styraciflua","Platanus x acerifolia","Acer platanoides","Pseudolarix amabilis","Liquidambar styraciflua","Acer platanoides","Pinus jeffreyi","Pinus nigra","Acer platanoides","Quercus palustris","Malus spp.","Pinus nigra","Pinus ponderosa","Quercus rubra","Quercus palustris","Acer platanoides","Quercus palustris","Malus spp.","Platanus x acerifolia","Pseudolarix amabilis","Ilex aquifolium","Liquidambar styraciflua","Quercus palustris","Pinus ponderosa","Acer platanoides","Acer platanoides","Malus spp.","Liquidambar styraciflua","Pinus nigra","Cedrus deodara","Malus spp.","Liquidambar styraciflua","Malus spp.","Malus spp.","Pinus jeffreyi","Pinus nigra","Acer platanoides","Malus spp.","Pinus ponderosa","Pinus ponderosa","Ginkgo biloba","Cedrus deodara","Ginkgo biloba","Calocedrus decurrens","Malus spp.","Juglans regia","Pinus ponderosa","Nyssa sylvatica","Acer platanoides","Tilia platyphyllos","Malus spp.","Metasequoia glyptostroboides","Pyrus calleryana","Thuja plicata","Cedrus deodara","Cedrus deodara","Thuja plicata","Quercus palustris","Platanus x acerifolia","Liquidambar styraciflua","Platanus x acerifolia","Acer platanoides","Nyssa sylvatica","Acer platanoides","Nyssa sylvatica","Picea pungens","Acer platanoides","Liquidambar styraciflua","Quercus palustris","Acer platanoides","Quercus palustris","Quercus palustris","Picea abies","Pinus ponderosa","Malus spp.","Cedrus deodara","Pinus nigra","Quercus palustris","Pinus jeffreyi","Pinus ponderosa","Fraxinus americana","Malus spp.","Pinus ponderosa","Calocedrus decurrens","Quercus palustris","Cedrus deodara","Lagerstroemia spp.","Fraxinus americana","Quercus palustris","Arbutus menziesii","Liquidambar styraciflua","Malus spp.","Malus spp.","Zelkova serrata","Acer platanoides","Platanus x acerifolia","Malus spp.","Cedrus atlantica 'Glauca'","Populus trichocarpa","Platanus x acerifolia","Quercus palustris","Quercus palustris","Quercus palustris","Acer platanoides","Magnolia spp.","Tilia platyphyllos","Quercus palustris","Quercus palustris","Thuja plicata","Picea abies","Pinus ponderosa","Pinus ponderosa","Pinus ponderosa","Acer macrophyllum","Fraxinus americana","Malus domestica","Liquidambar styraciflua","Cedrus deodara","Acer platanoides","Malus spp.","Tilia cordata","Acer platanoides","Cedrus deodara","Tilia cordata","Cornus kousa","Liquidambar styraciflua","Nyssa sylvatica","Cedrus atlantica 'Glauca'","Malus spp.","Fraxinus americana","Cedrus atlantica 'Glauca'","Thuja plicata","Malus spp.","Fraxinus americana","Quercus palustris","Quercus palustris","Quercus phellos","Cedrus deodara","Nyssa sylvatica","Pinus ponderosa","Malus spp.","Acer platanoides","Quercus palustris","Calocedrus decurrens","Thuja plicata","Malus spp.","Fraxinus pennsylvanica","Pinus ponderosa","Malus spp.","Picea abies","Thuja plicata","Pinus ponderosa","Picea abies","Tilia platyphyllos","Pseudolarix amabilis","Quercus phellos","Malus spp.","Quercus palustris","Quercus palustris","Quercus palustris","Pinus ponderosa","Cedrus deodara","Pinus ponderosa","Pyrus calleryana","Calocedrus decurrens","Calocedrus decurrens","Calocedrus decurrens","Calocedrus decurrens","Acer circinatum","Calocedrus decurrens","Acer circinatum","Acer circinatum","Acer circinatum","Cercidiphyllum japonicum","Acer circinatum","Acer circinatum","Acer griseum","Calocedrus decurrens","Pyrus calleryana","Pyrus calleryana","Pyrus calleryana","Cornus kousa","Calocedrus decurrens","Calocedrus decurrens","Calocedrus decurrens","Calocedrus decurrens","Stewartia pseudocamellia","Nyssa sylvatica","Platanus x acerifolia","Calocedrus decurrens","Calocedrus decurrens","Acer circinatum","Acer circinatum","Sequoiadendron giganteum","Fraxinus americana","Acer circinatum","Sequoiadendron giganteum","Acer circinatum","Acer circinatum","Fraxinus americana","Acer rubrum","Alnus rubra","Fraxinus americana","Fraxinus americana","Fraxinus americana","Fraxinus americana","Fraxinus americana","Acer platanoides","Fraxinus americana","Fraxinus latifolia","Acer palmatum","Acer circinatum","Calocedrus decurrens","Calocedrus decurrens","Acer circinatum","Calocedrus decurrens","Calocedrus decurrens","Calocedrus decurrens","Acer circinatum","Acer palmatum","Sequoiadendron giganteum","Taxodium distichum","Acer circinatum","Acer circinatum","Sequoiadendron giganteum","Acer griseum","Fraxinus latifolia","Acer rubrum","Acer circinatum","Acer circinatum","Calocedrus decurrens","Fraxinus americana","Cercidiphyllum japonicum","Cercidiphyllum japonicum","Cedrus atlantica 'Glauca'","Unknown (dead)","Acer rubrum","Fraxinus americana","Fraxinus americana","Fraxinus latifolia","Cercidiphyllum japonicum","Cercidiphyllum japonicum","Cercis canadensis","Calocedrus decurrens","Calocedrus decurrens","Calocedrus decurrens","Acer circinatum","Calocedrus decurrens","Acer circinatum","Cedrus deodara","Metasequoia glyptostroboides","Metasequoia glyptostroboides","Acer circinatum","Acer circinatum","Aesculus x carnea","Acer griseum","Cedrus atlantica 'Glauca'","Calocedrus decurrens","Acer circinatum","Fraxinus americana","Fraxinus americana","Populus trichocarpa","Fraxinus americana","Fraxinus americana","Fraxinus americana","Fraxinus americana","Fraxinus latifolia","Acer palmatum","Acer circinatum","Acer circinatum","Fraxinus americana","Fraxinus americana","Acer rubrum","Fraxinus americana","Cercidiphyllum japonicum","Fraxinus americana","Fraxinus americana","Fraxinus americana","Fraxinus americana","Fraxinus latifolia","Fraxinus americana","Fraxinus americana","Fraxinus latifolia","Pinus ponderosa","Pinus jeffreyi","Quercus palustris","Quercus palustris","Quercus palustris","Quercus garryana","Pinus strobus","Chamaecyparis lawsoniana","Chamaecyparis lawsoniana","Carpinus caroliniana","Carpinus caroliniana","Thuja plicata","Cedrus deodara","Fraxinus latifolia","Fraxinus latifolia","Fraxinus latifolia","Quercus palustris","Quercus palustris","Quercus palustris","Quercus palustris","Pinus strobus","Gleditsia triacanthos","Chionanthus retusus","Acer saccharum","Acer saccharum","Thuja plicata","Acer platanoides","Tilia cordata","Pseudotsuga menziesii","Nyssa sylvatica","Quercus coccinea","Fraxinus latifolia","Nyssa sylvatica","Malus domestica","Malus domestica","Quercus palustris","Quercus palustris","Quercus palustris","Pseudolarix amabilis","Gleditsia triacanthos","Quercus palustris","Quercus palustris","Pinus ponderosa","Pseudolarix amabilis","Cercis canadensis","Acer saccharum","Cornus kousa","Liquidambar styraciflua","Acer rubrum","Pseudotsuga menziesii","Prunus cerasifera","Prunus cerasifera","Liquidambar styraciflua","Acer platanoides","Thuja plicata","Pyrus communis","Celtis occidentalis","Chamaecyparis lawsoniana","Carpinus caroliniana","Platanus x acerifolia","Cedrus deodara","Fraxinus latifolia","Fraxinus latifolia","Fraxinus latifolia","Celtis occidentalis","Quercus palustris","Acer platanoides","Sequoiadendron giganteum","Sequoiadendron giganteum","Betula pendula","Liquidambar styraciflua","Juglans nigra","Acer platanoides","Cornus nuttallii","Cedrus deodara","Nyssa sylvatica","Sequoiadendron giganteum","Populus nigra","Ginkgo biloba","Cedrus deodara","Fraxinus latifolia","Fraxinus latifolia","Picea pungens","Fraxinus latifolia","Quercus palustris","Malus spp.","Malus spp.","Pinus sylvestris","Fraxinus latifolia","Fraxinus latifolia","Unknown (dead)","Platanus x acerifolia","Malus domestica","Sequoiadendron giganteum","Acer pseudoplatanus","Carpinus caroliniana","Fraxinus latifolia","Fraxinus latifolia","Prunus cerasifera","Unknown (dead)","Nyssa sylvatica","Quercus coccinea","Zelkova serrata","Acer platanoides","Liquidambar styraciflua","Quercus palustris","Betula pendula","Pinus nigra","Fraxinus latifolia","Pinus sylvestris","Fraxinus latifolia","Fraxinus latifolia","Pseudotsuga menziesii","Populus nigra","Populus nigra","Acer platanoides","Malus spp.","Sequoiadendron giganteum","Betula pendula","Juglans nigra","Sequoiadendron giganteum","Fraxinus latifolia","Arbutus menziesii","Pinus sylvestris","Cedrus deodara","Nyssa sylvatica","Acer pseudoplatanus","Pseudotsuga menziesii","Fraxinus latifolia","Pseudotsuga menziesii","Populus nigra","Populus nigra","Prunus cerasifera","Populus nigra","Populus nigra","Thuja plicata","Populus nigra","Populus nigra","Populus nigra","Pinus nigra","Cedrus deodara","Cedrus deodara","Quercus phellos","Betula pendula","Quercus phellos","Fraxinus latifolia","Fraxinus latifolia","Pinus strobus","Carpinus caroliniana","Fraxinus latifolia","Fraxinus latifolia","Cedrus deodara","Pinus nigra","Carpinus caroliniana","Cedrus deodara","Pinus nigra","Pinus monticola","Pinus ponderosa","Picea abies","Prunus cerasifera","Pseudotsuga menziesii","Prunus cerasifera","Crataegus monogyna","Prunus cerasifera","Pseudotsuga menziesii","Prunus cerasifera","Pseudotsuga menziesii","Pinus nigra","Picea abies","Picea abies","Prunus cerasifera","Acer macrophyllum","Picea abies","Picea abies","Picea abies","Picea abies","Fraxinus latifolia","Pseudotsuga menziesii","Crataegus monogyna","Acer macrophyllum","Prunus cerasifera","Pinus sylvestris","Picea abies","Arbutus menziesii","Pseudotsuga menziesii","Prunus cerasifera","Pseudotsuga menziesii","Quercus rubra","Quercus phellos","Quercus phellos","Betula pendula","Platanus x acerifolia","Thuja plicata","Pinus ponderosa","Liquidambar styraciflua","Pseudotsuga menziesii","Fraxinus americana","Fraxinus angustifolia","Acer pseudoplatanus","Carpinus caroliniana","Quercus phellos","Betula pendula","Unknown (dead)","Pinus ponderosa","Picea abies","Pinus ponderosa","Picea abies","Pinus ponderosa","Populus trichocarpa","Fraxinus latifolia","Fraxinus angustifolia","Fraxinus latifolia","Pinus nigra","Carpinus caroliniana","Pinus ponderosa","Pinus ponderosa","Picea abies","Pinus ponderosa","Picea abies","Picea abies","Picea abies","Fraxinus latifolia","Fraxinus latifolia","Fraxinus latifolia","Fraxinus angustifolia","Fraxinus angustifolia","Picea abies","Picea abies","Pinus ponderosa","Liquidambar styraciflua","Pinus ponderosa","Liquidambar styraciflua","Unknown (dead)","Fraxinus latifolia","Fraxinus latifolia","Nyssa sylvatica","Fraxinus latifolia","Cornus mas","Abies nordmanniana","Malus domestica","Quercus rubra","Abies nordmanniana","Acer platanoides","Acer platanoides","Acer platanoides","Acer platanoides","Sequoiadendron giganteum","Acer macrophyllum","Thuja plicata","Thuja plicata","Zelkova serrata","Acer macrophyllum","Zelkova serrata","Acer rubrum","Ulmus americana","Thuja plicata","Acer macrophyllum","Betula pendula","Betula pendula","Thuja plicata","Fagus sylvatica","Thuja plicata","Cornus kousa","Cornus kousa","Pinus contorta","Pseudotsuga menziesii","Acer platanoides","Quercus rubra","Quercus rubra","Ulmus americana","Thuja plicata","Acer circinatum","Cornus kousa","Fraxinus pennsylvanica","Pinus contorta","Betula pendula","Acer circinatum","Prunus (cherry species and cultivars)","Acer platanoides","Acer platanoides","Acer platanoides","Ulmus americana","Thuja plicata","Acer macrophyllum","Fraxinus pennsylvanica","Fraxinus pennsylvanica","Prunus (cherry species and cultivars)","Abies nordmanniana","Malus domestica","Prunus (plum species and cultivars)","Prunus (plum species and cultivars)","Acer platanoides","Acer platanoides","Acer platanoides","Ulmus americana","Acer platanoides","Acer platanoides","Crataegus laevigata","Pseudotsuga menziesii","Quercus rubra","Acer x freemanii","Thuja plicata","Acer macrophyllum","Thuja plicata","Thuja plicata","Acer macrophyllum","Acer macrophyllum","Betula pendula","Thuja plicata","Thuja plicata","Malus spp.","Betula pendula","Ulmus x","Pinus ponderosa","Sequoiadendron giganteum"],{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]}],"setView":[[45.474,-122.719],16,[]],"limits":{"lat":[45.4691172454087,45.4761094007654],"lng":[-122.722999758905,-122.715558277497]}},"evals":[],"jsHooks":[]}</script>
<p>Note: Leaflet <a
href="https://rstudio.github.io/leaflet/shiny.html">works well with
Shiny</a>, and has <code>leafletOutput</code>/<code>renderLeaflet</code>
functions that behave as you would expect.</p>
</div>
</div>
<div id="how-about-a-chloropleth-map" class="section level1" number="5">
<h1><span class="header-section-number">5</span> How about a chloropleth
map?</h1>
<p>Changing gears, we now turn to chloropleth maps. As we discussed on
Tuesday, a very important consideration when working with a chloropleth
map is that one must <em>normalize</em> quantities consistently across
the regions of the map.</p>
<p>Continuing with our Portland-themed lab, we will be working with a <a
href="https://www.portlandoregon.gov/civic/28387">dataset produced by
the City</a> that aligns our neighborhood districts with their
corresponding data from the 2010 Census. This data set includes a great
deal of information about each neighborhood’s demographics; for now, we
will work with the total population.</p>
<p>We will need to <em>join</em> our existing dataframe of neighborhood
boundaries with this Census dataset; while both include neighborhood
names, there is some variability in how the neighborhoods are referred
to (“PEARL” vs. “PEARL DISTRICT”) that we must deal with. This issue is
extremely common when working with this kind of data, especially at the
level of neighborhoods. Many administrative regions/districts have
standardized numerical codes, maintained by the USGS and the Census
Bureau, and you will likely have better luck using those to merge
datasets rather than relying on names.</p>
<pre class="r"><code># pull data out of the Excel file, by cell range
pdx_population &lt;- read_excel(&quot;data/lab08/Census_2010_Data_Cleanedup.xlsx&quot;,
                             sheet=&quot;Census_2010_Neighborhoods&quot;, 
                             range=&quot;A7:B101&quot;, 
                             col_names = c(&quot;Neighborhood&quot;, &quot;Total.Pop&quot;)) %&gt;%   
                  mutate(Neighborhood=as.factor(Neighborhood))

# we need to do a tiny bit of cleanup; the census spreadsheet has some slightly different names
pdx_population &lt;- pdx_population %&gt;% mutate(Neighborhood=recode(Neighborhood,
  &quot;ARGAY&quot; = &quot;ARGAY TERRACE&quot;,
  &quot;BROOKLYN&quot; = &quot;BROOKLYN ACTION CORPS&quot;,
  &quot;BUCKMAN&quot; = &quot;BUCKMAN COMMUNITY ASSOCIATION&quot;,
  &quot;CENTENNIAL&quot; = &quot;CENTENNIAL COMMUNITY ASSOCIATION&quot;,
  &quot;CULLY&quot; = &quot;CULLY ASSOCIATION OF NEIGHBORS&quot;,
  &quot;CENTENNIAL&quot; = &quot;CENTENNIAL COMMUNITY ASSOCIATION&quot;,
  &quot;DOWNTOWN&quot; = &quot;PORTLAND DOWNTOWN&quot;,
  &quot;GOOSE HOLLOW&quot; = &quot;GOOSE HOLLOW FOOTHILLS LEAGUE&quot;,
  &quot;HAYDEN ISLAND&quot; = &quot;HAYDEN ISLAND NEIGHBORHOOD NETWORK&quot;,
  &quot;HOSFORD-ABERNETHY&quot; = &quot;HOSFORD-ABERNETHY NEIGHBORHOOD DISTRICT ASSN.&quot;,
  &quot;IRVINGTON&quot; = &quot;IRVINGTON COMMUNITY ASSOCIATION&quot;,
  &quot;LLOYD DISTRICT&quot; = &quot;LLOYD DISTRICT COMMUNITY ASSOCIATION&quot;,
  &quot;NORTHWEST DISTRICT&quot; = &quot;NORTHWEST DISTRICT ASSOCIATION&quot;,
  &quot;OLD TOWN-CHINATOWN&quot; = &quot;OLD TOWN COMMUNITY ASSOCIATION&quot;,
  &quot;PARKROSE HEIGHTS&quot; = &quot;PARKROSE HEIGHTS ASSOCIATION OF NEIGHBORS&quot;,
  &quot;PEARL&quot; = &quot;PEARL DISTRICT&quot;,
  &quot;SABIN&quot; = &quot;SABIN COMMUNITY ASSOCIATION&quot;,
  &quot;SELLWOOD-MORELAND&quot; = &quot;SELLWOOD-MORELAND IMPROVEMENT LEAGUE&quot;,
  &quot;SOUTHWEST HILLS&quot; = &quot;SOUTHWEST HILLS RESIDENTIAL LEAGUE&quot;,
  &quot;SUMNER&quot; = &quot;SUMNER ASSOCIATION OF NEIGHBORS&quot;,
  &quot;SUNDERLAND&quot; = &quot;SUNDERLAND ASSOCIATION OF NEIGHBORS&quot;,
  &quot;WILKES&quot; = &quot;WILKES COMMUNITY GROUP&quot;
))

# and now left join with our boundary data set- note that there will be some regions with no population data, so we want a left-join
boundaries_with_pop &lt;- left_join(pdx_boundaries, pdx_population, by=c(&quot;NAME&quot;=&quot;Neighborhood&quot;))
boundaries_with_pop %&gt;% glimpse</code></pre>
<pre><code>## Rows: 98
## Columns: 12
## $ OBJECTID   &lt;int&gt; 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, …
## $ NAME       &lt;chr&gt; &quot;CATHEDRAL PARK&quot;, &quot;UNIVERSITY PARK&quot;, &quot;PIEDMONT&quot;, &quot;WOODLAWN&quot;…
## $ COMMPLAN   &lt;chr&gt; NA, NA, &quot;ALBINA&quot;, &quot;ALBINA&quot;, NA, &quot;ALBINA&quot;, &quot;ALBINA&quot;, &quot;ALBINA…
## $ SHARED     &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…
## $ COALIT     &lt;chr&gt; &quot;NPNS&quot;, &quot;NPNS&quot;, &quot;NPNS&quot;, &quot;NECN&quot;, &quot;CNN&quot;, &quot;NPNS&quot;, &quot;NPNS&quot;, &quot;NEC…
## $ HORZ_VERT  &lt;chr&gt; &quot;HORZ&quot;, &quot;HORZ&quot;, &quot;VERT&quot;, &quot;HORZ&quot;, &quot;HORZ&quot;, &quot;HORZ&quot;, &quot;HORZ&quot;, &quot;HO…
## $ MAPLABEL   &lt;chr&gt; &quot;Cathedral Park&quot;, &quot;University Park&quot;, &quot;Piedmont&quot;, &quot;Woodlawn&quot;…
## $ ID         &lt;int&gt; 31, 88, 70, 93, 23, 2, 66, 19, 67, 84, 44, 48, 89, 63, 74, …
## $ Shape_Leng &lt;dbl&gt; 11434.255, 11950.860, 10849.327, 8078.361, 18179.392, 9466.…
## $ Shape_Area &lt;dbl&gt; 5424297.8, 6981456.8, 6079530.0, 3870553.6, 16580624.7, 458…
## $ Total.Pop  &lt;dbl&gt; 3349, 6035, 7025, 4933, 13209, 6153, 6093, 9550, 6363, 2137…
## $ geometry   &lt;MULTIPOLYGON [m]&gt; MULTIPOLYGON (((-13664216 5..., MULTIPOLYGON (…</code></pre>
<p>Now that we’ve got the population column, we can tell
<code>geom_sf</code> to use it for the “fill” aesthetic:</p>
<pre class="r"><code>boundaries_with_pop %&gt;% ggplot() + 
  geom_sf(aes(fill=Total.Pop)) +
  scale_fill_gradient() +
  geom_sf(data=river_boundaries, fill=&quot;blue&quot;, size=0.0) </code></pre>
<p><img src="08-maps_files/figure-html/unnamed-chunk-31-1.png" width="672" /></p>
<p>This is, of course, ignoring the first rule of chloropleth maps:
beware of differing region sizes! We should really be plotting
<em>population density</em>- people per square kilometer, or something
like that. Our shapefile with Portland’s neighborhoods helpfully
includes a column with each neighborhood’s area, in square meters, for
precisely this purpose.</p>
<pre class="r"><code># compute people per square kilometer
# NB: Shape_Area is in meters^2
boundaries_with_pop &lt;- boundaries_with_pop %&gt;% 
  mutate(adj_pop = (Total.Pop / (Shape_Area / 1E6))) %&gt;% arrange(adj_pop)</code></pre>
<p>Now, let’s look at our revised map:</p>
<p><img src="08-maps_files/figure-html/first%20attempt%20at%20density%20map-1.png" width="672" /></p>
<p>That’s much better!</p>
<div class="panel panel-success">
<div class="panel-heading">
Challenge #7:
</div>
<div class="panel-body">
<p>Look at the original spreadsheet and pick another column of interest
(besides total population); revise the data ingest process, and map
<em>that</em> column instead.</p>
</div>
</div>
<div id="setting-color-scales" class="section level2" number="5.1">
<h2><span class="header-section-number">5.1</span> Setting Color
Scales</h2>
<p>The default colors have three big issues:</p>
<ol style="list-style-type: decimal">
<li>They are blue, so conflict with the river</li>
<li>We have some missing data (i.e., neighborhoods where we don’t have
population data) and those are not apparent in this scale</li>
<li>The scale may be highlighting certain differences at the expense of
others.</li>
</ol>
<p>Let’s explore some different coloring options! First, let’s
familiarize ourselves with the data distribution across
neighborhoods.</p>
<p><img src="08-maps_files/figure-html/unnamed-chunk-32-1.png" width="672" /></p>
<p>We can see straight away that the distribution is not uniform- there
are some outlier neighborhoods with much higher population density.
Another way to look at this is with a histogram:</p>
<p><img src="08-maps_files/figure-html/unnamed-chunk-33-1.png" width="672" /></p>
<p>If we have uniform distribution of data, a uniform color scale may be
what we want, but in this case it is not: the color range is going to be
very compressed down in the range at which most of the data lives. Let’s
explore four different options:</p>
<ol style="list-style-type: decimal">
<li>Equal spacing across the entire range of data</li>
<li>Quantile spacing (i.e., color breaks at each quantile boundary)</li>
<li>A simple breaking scheme that takes into account the data’s
variability (i.e., more breaks for more variable data)</li>
<li>A more sophisticated adaptive scheme (Jenks’ algorithm), that looks
for “natural” breaks in the range of data.</li>
</ol>
<pre class="r"><code># following https://blog.datawrapper.de/how-to-choose-a-color-palette-for-choropleth-maps/
# and https://rpubs.com/danielkirsch/styling-choropleth-maps

min.pop &lt;- min(boundaries_with_pop$adj_pop, na.rm=TRUE)
max.pop &lt;- max(boundaries_with_pop$adj_pop, na.rm=TRUE)
diff.pop &lt;- max.pop - min.pop
std.dev.pop &lt;- sd(boundaries_with_pop$adj_pop, na.rm = TRUE)

# some possible color break points
equal.interval &lt;- seq(min.pop, max.pop, by= diff.pop / 6) 
quantile.interval &lt;- quantile(boundaries_with_pop$adj_pop, probs=seq(0, 1, by = 1/6), na.rm = TRUE)
std.interval &lt;- c(seq(min.pop, max.pop, by=std.dev.pop), max.pop)
jenks.interval &lt;- classIntervals(boundaries_with_pop$adj_pop, n=6, style=&#39;jenks&#39;)$brks

# now assign neighborhoods to their bin, using each of these methods:

# 6 equal cut-points across the population range
boundaries_with_pop$pop.equal = cut(boundaries_with_pop$adj_pop, breaks=equal.interval, include.lowest = TRUE)

# Cut-points at population quantiles
boundaries_with_pop$pop.quantile = cut(boundaries_with_pop$adj_pop, breaks=quantile.interval, include.lowest = TRUE)

# Cut points at increments of the standard deviation of the dataset
boundaries_with_pop$pop.std = cut(boundaries_with_pop$adj_pop, breaks=std.interval, include.lowest = TRUE)

# Jenks&#39;s algorithm for adaptive breakpoints
boundaries_with_pop$pop.jenks = cut(boundaries_with_pop$adj_pop, breaks=jenks.interval, include.lowest = TRUE)</code></pre>
<p>Now we can visualize which neighborhoods would be colored similarly
under the different schemes:</p>
<pre class="r"><code>popDensBarChart &lt;- function(break_col) {
  boundaries_with_pop %&gt;% 
  filter(!is.na(adj_pop)) %&gt;% 
  ggplot(mapping = aes(x=fct_reorder(MAPLABEL, -adj_pop), y=adj_pop)) +
    geom_col(aes(fill=.data[[break_col]])) +
    # theme(axis.text.x=element_text(angle=270, hjust=0, size=6, vjust=0.5)) +
  theme(axis.text.x=element_blank(), axis.ticks.x=element_blank()) +
    scale_y_continuous(name=expression(&quot;People/km&quot; ^2)) +
  scale_x_discrete(name=NULL) +
    scale_fill_discrete(guide=FALSE) +
  ggtitle(break_col)
}

plot_grid(
  popDensBarChart(&quot;pop.equal&quot;),
  popDensBarChart(&quot;pop.quantile&quot;),
  popDensBarChart(&quot;pop.std&quot;),
  popDensBarChart(&quot;pop.jenks&quot;),
  nrow=2, ncol=2
)</code></pre>
<p><img src="08-maps_files/figure-html/unnamed-chunk-35-1.png" width="672" /></p>
<p>We can see here that the quantile method is probably not what we
want: lots of the denser counties are getting lumped together in a way
that they probably shouldn’t be. Now let’s try using different ones of
these for our map. While we’re at it, we are going to change our color
scheme as well.</p>
<p><img src="08-maps_files/figure-html/map%20with%20different%20breaks-1.png" width="672" /><img src="08-maps_files/figure-html/map%20with%20different%20breaks-2.png" width="672" /><img src="08-maps_files/figure-html/map%20with%20different%20breaks-3.png" width="672" /><img src="08-maps_files/figure-html/map%20with%20different%20breaks-4.png" width="672" /></p>
<div class="panel panel-success">
<div class="panel-heading">
Challenge #8:
</div>
<div class="panel-body">
<p>Perform a similar analysis for the census data column you are working
with. Is six the right number of bins? Which method works best for your
specific data?</p>
</div>
</div>
</div>
</div>
<div id="using-tmap" class="section level1" number="6">
<h1><span class="header-section-number">6</span> Using
<code>tmap</code></h1>
<p><code>tmap</code> is a powerful library for “thematic maps”-
chloropleth maps, etc. It has some additional capabilities beyond what
<code>ggplot</code> and <code>geom_sf</code> have to offer, and if you
find yourself doing a lot of mapping, it is probably worth checking
out.</p>
<pre class="r"><code>tm_shape(pdx_boundaries) + 
  tm_fill() + 
  tm_borders() + 
  tm_shape(river_boundaries) + 
  tm_fill(col=&quot;blue&quot;)</code></pre>
<p><img src="08-maps_files/figure-html/tmap%20example-1.png" width="672" /></p>
</div>
<div id="bonus-useful-shiny-app-for-bounding-box-calculation"
class="section level1" number="7">
<h1><span class="header-section-number">7</span> Bonus: Useful Shiny App
for Bounding Box Calculation</h1>
<p>This is a small Shiny app for helping with finding bounding box
locations by clicking on a map.</p>
<pre class="r"><code>library(shiny)
ui &lt;- fluidPage(
  titlePanel(&quot;Bounding Box Calculator&quot;),
  fluidRow(
    column(6, plotOutput(&quot;boundaryPlot&quot;, click=&quot;plot_click&quot;)),
    column(6, plotOutput(&quot;zoomedMap&quot;))
           ),
  textOutput(&quot;clicked_pt&quot;)
)

server &lt;- function(input, output, session) {
  
  pdx_bbox &lt;- st_bbox(pdx_boundaries)
  centerX &lt;- pdx_bbox$xmin + ((pdx_bbox$xmax - pdx_bbox$xmin) / 2)
  centerY &lt;- pdx_bbox$ymin + ((pdx_bbox$ymax - pdx_bbox$ymin) / 2)
  # initial values
  vals &lt;- reactiveValues(
    x=centerX,
    y=centerY
  )
  
  # udpate on click
  observeEvent(input$plot_click, {
    vals$x = input$plot_click$x
    vals$y = input$plot_click$y
  })
  
  output$boundaryPlot &lt;- renderPlot({
    pdx_boundaries %&gt;% ggplot() + geom_sf() +
      geom_sf(data=river_boundaries, fill=&quot;blue&quot;, size=0.0)  +
      geom_hline(yintercept=vals$y, linetype=&quot;dashed&quot;, color=&quot;red&quot;, alpha=0.7) + 
      geom_vline(xintercept = vals$x, linetype=&quot;dashed&quot;, color=&quot;red&quot;, alpha=0.7)
  })
  
  output$zoomedMap &lt;- renderPlot({
    pdx_boundaries %&gt;% ggplot() + 
      geom_sf() + 
      geom_sf(data=river_boundaries, fill=&quot;blue&quot;, size=0.0) +
      coord_sf(xlim=c(vals$x - 2000,vals$x + 2000), ylim=c(vals$y - 2000, vals$y + 2000))  + 
      geom_sf_label(aes(label=MAPLABEL))
  })
  
  output$clicked_pt &lt;- renderText(paste0(&quot;lon: &quot;, vals$x, &quot; lat: &quot;, vals$y))

}

shinyApp(ui = ui, server = server)</code></pre>
<pre><code>## 
## Listening on http://127.0.0.1:7335</code></pre>
<p><img src="08-maps_files/figure-html/useful%20shiny%20app-1.png" width="672" /></p>
</div>

<p>
<a rel="license" href="http://creativecommons.org/licenses/by-nc/4.0/">
<img alt="Creative Commons License" style="border-width:0" src="by-nc.png" width="133" height="25"/></a>
</p>


</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->

<script>
$(document).ready(function ()  {

    // temporarily add toc-ignore selector to headers for the consistency with Pandoc
    $('.unlisted.unnumbered').addClass('toc-ignore')

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
